{"ast":null,"code":"var _jsxFileName = \"/Users/tristanbilot/Desktop/Design4green/design4green/src/Components/GraphPage.js\";\nimport React, { Component } from 'react';\nimport { GanttComponent, Inject, Selection, Toolbar, ExcelExport, PdfExport, ColumnsDirective, ColumnDirective } from '@syncfusion/ej2-react-gantt';\nimport { editingResources } from './scripts/graph_data';\nimport DataFrame from \"dataframe-js\";\nimport './css/graph.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass GraphPage extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      dataframe: props.dataframe,\n      basket: props.basket,\n      columns: [],\n      graph: [],\n      graphLabels: []\n    };\n    this.taskbarWithColorBinded = this.taskbarWithColor.bind(this);\n    this.taskBarColors = {\n      \"STRATEGIE\": \"#1b5e20\",\n      \"SPECIFICATIONS\": \"#00695c\",\n      \"UX/UI\": \"#0097a7\",\n      \"CONTENUS\": \"#039be5\",\n      \"ARCHITECTURE\": \"#2196f3\",\n      \"FRONTEND\": \"#5c6bc0\",\n      \"BACKEND\": \"#9575cd\",\n      \"HEBERGEMENT\": \"#ce93d8\"\n    };\n    this.taskFields = {\n      id: 'TaskID',\n      name: 'TaskName',\n      startDate: 'StartDate',\n      endDate: 'EndDate',\n      duration: 'Duration',\n      progress: 'Progress',\n      dependency: 'Predecessor',\n      child: 'subtasks',\n      resourceInfo: 'resources'\n    };\n    this.resourceFields = {\n      id: 'resourceId',\n      name: 'resourceName'\n    };\n    this.splitterSettings = {\n      columnIndex: 2\n    };\n    this.projectStartDate = new Date();\n    let projectNbDays = 40;\n    this.projectEndDate = new Date(Date.now() + 1000 * 60 * 60 * 24 * projectNbDays);\n    this.gridLines = 'Both';\n    this.toolbar = ['ExcelExport', 'CsvExport', 'PdfExport'];\n    this.timelineSettings = {\n      topTier: {\n        unit: 'Week',\n        format: 'MMM dd, y'\n      },\n      bottomTier: {\n        unit: 'Day'\n      }\n    };\n    this.labelSettings = {\n      // leftLabel: 'TaskName',\n      rightLabel: 'resources'\n    };\n  }\n\n  async componentWillMount() {\n    await this.getGanttGraph();\n  }\n\n  async getGanttGraph(criterions) {\n    if (this.state.dataframe == null) return [];\n    let cycleLifeCategories = ['Acquisition', 'Conception', 'Réalisation', 'Déploiement', 'Administration', 'Utilisation', 'Maintenance', 'Fin de Vie', 'Revalorisation'];\n    let graph = [];\n    let labels = [];\n    let day = 1000 * 60 * 60 * 24;\n    let baseXPosition = this.projectStartDate;\n    let widthOfCycleLife = 4;\n    let i = 1;\n    var lastCycle = null;\n    this.state.basket.forEach(element => {\n      let cycleLifeIndex = cycleLifeCategories.indexOf(element.cycle);\n      let begXPosition = new Date(baseXPosition.getTime() + widthOfCycleLife * cycleLifeIndex * day);\n      let endXPosition = new Date(baseXPosition.getTime() + widthOfCycleLife * cycleLifeIndex * day + widthOfCycleLife * day);\n      let node = {\n        TaskID: i,\n        TaskName: element.useCase,\n        StartDate: begXPosition,\n        EndDate: endXPosition,\n        subtasks: [],\n        category: element.family,\n        useCase: element.useCase\n      };\n\n      if (lastCycle != null && lastCycle != element.cycle) {\n        node[\"Predecessor\"] = i - 1;\n      }\n\n      graph.push(node);\n      lastCycle = element.cycle;\n      labels.push({\n        resourceId: i++,\n        resourceName: element.criterion\n      });\n    });\n    this.setState({\n      graph: graph,\n      graphLabels: labels\n    });\n  }\n\n  getGanttInfoAsDataframe(ids) {\n    let dfs = []; // for each id, fetch the required column infos \n\n    ids.forEach(id => {\n      let df = this.state.dataframe.filter(row => row.get(\"ID\") === id).select(\"Famille d'origine\", \"CRITERES\", \"Etape Cycle de Vie\", \"incontournables\", \"Use Case\", \"JUSTIFICATIONS\", \"Priorité\");\n      dfs.push(df);\n    }); // merge all the rows dataframes in one dataframe\n\n    let totalDf = new DataFrame([]);\n    dfs.forEach(df => {\n      totalDf = totalDf.union(df);\n    }); // parse the priority to integers\n\n    totalDf = totalDf.chain(this.translatePriorityToInteger);\n    totalDf = this.sortDataframe(totalDf);\n    return totalDf;\n  }\n\n  translatePriorityToInteger(row) {\n    let priority = row.get(\"Priorité\");\n    let priorities = {\n      \"Low\": 1,\n      \"Medium\": 2,\n      \"High\": 3,\n      \"\": 4\n    };\n    row = row.set(\"Priorité\", priorities[priority]);\n    return row;\n  }\n\n  translateCycleLifeToInteger(row) {\n    let cycleLife = row.get(\"Etape Cycle de Vie\");\n    let priorities = ['Acquisition', 'Conception', 'Réalisation', 'Déploiement', 'Administration', 'Utilisation', 'Maintenance', 'Fin de Vie', 'Revalorisation'];\n    row = row.set(\"Cycle life priority\", priorities.indexOf(cycleLife));\n    return row;\n  }\n\n  sortDataframe(df) {\n    // add a new colum with an integer representing the priority based on cycle life\n    df = df.withColumn(\"Cycle life priority\");\n    df = df.chain(this.translateCycleLifeToInteger); // sort first by priority and then by cycle life to make groups\n\n    df = df.sortBy(\"Priorité\");\n    df = df.sortBy(\"Cycle life priority\");\n    return df;\n  }\n\n  timeout(delay) {\n    return new Promise(res => setTimeout(res, delay));\n  }\n\n  taskbarWithColor(props) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"e-gantt-child-taskbar e-custom-moments\",\n      style: {\n        height: \"100%\",\n        borderRadius: \"5px\",\n        backgroundColor: this.taskBarColors[props.taskData.category],\n        textAlign: \"center\"\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"e-task-label\",\n          style: {\n            textOoverflow: \"ellipsis\",\n            height: \"90%\",\n            overflow: \"hidden\",\n            color: \"white\",\n            fontSize: \"10px\"\n          },\n          children: props.taskData.useCase\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 9\n    }, this);\n  }\n\n  toolbarClick(args) {\n    if (args.item.id === \"GanttExport_excelexport\") {\n      this.ganttInstance.excelExport();\n    } else if (args.item.id === \"GanttExport_csvexport\") {\n      this.ganttInstance.csvExport();\n    } else if (args.item.id === \"GanttExport_pdfexport\") {\n      this.ganttInstance.pdfExport();\n    }\n  }\n\n  loadLegend() {\n    let colors = {\n      \"STRATEGIE\": \"#1b5e20\",\n      \"SPECIFICATIONS\": \"#00695c\",\n      \"UX/UI\": \"#0097a7\",\n      \"CONTENUS\": \"#039be5\",\n      \"ARCHITECTURE\": \"#2196f3\",\n      \"FRONTEND\": \"#5c6bc0\",\n      \"BACKEND\": \"#9575cd\",\n      \"HEBERGEMENT\": \"#ce93d8\"\n    };\n    let elements = [];\n\n    for (const [label, color] of Object.entries(colors)) {\n      elements.push( /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col legend\",\n          style: {\n            backgroundColor: color\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col\",\n          children: label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 17\n      }, this));\n    }\n\n    return elements;\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"control-pane\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"margin30\",\n          children: \"Gantt planning\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"control-section\",\n          children: /*#__PURE__*/_jsxDEV(GanttComponent, {\n            id: \"GanttExport\",\n            ref: gantt => this.ganttInstance = gantt,\n            height: \"700px\",\n            rowHeight: 45,\n            taskbarHeight: 35,\n            dataSource: this.state.graph,\n            dateFormat: 'MMM dd, y',\n            treeColumnIndex: 1,\n            allowExcelExport: true,\n            allowPdfExport: true,\n            allowSelection: true,\n            showColumnMenu: false,\n            highlightWeekends: true,\n            allowUnscheduledTasks: true,\n            projectStartDate: this.projectStartDate,\n            projectEndDate: this.projectEndDate,\n            splitterSettings: this.splitterSettings,\n            taskFields: this.taskFields,\n            timelineSettings: this.timelineSettings,\n            labelSettings: this.labelSettings,\n            toolbarClick: this.toolbarClick.bind(this),\n            height: \"410px\",\n            gridLines: this.gridLines,\n            toolbar: this.toolbar,\n            resourceFields: this.resourceFields,\n            resources: editingResources,\n            taskbarTemplate: this.taskbarWithColorBinded,\n            children: [/*#__PURE__*/_jsxDEV(ColumnsDirective, {\n              children: [/*#__PURE__*/_jsxDEV(ColumnDirective, {\n                field: \"TaskID\",\n                width: \"60\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 231,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(ColumnDirective, {\n                field: \"TaskName\",\n                width: \"250\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 232,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(ColumnDirective, {\n                field: \"StartDate\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 233,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(ColumnDirective, {\n                field: \"EndDate\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 234,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(ColumnDirective, {\n                field: \"Duration\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 235,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(ColumnDirective, {\n                field: \"Predecessor\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 236,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(ColumnDirective, {\n                field: \"resources\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 237,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(ColumnDirective, {\n                field: \"Progress\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 238,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 230,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Inject, {\n              services: [Selection, Toolbar, ExcelExport, PdfExport]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 240,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 229,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"margin30\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Legend\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 13\n          }, this), this.loadLegend(), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"legend\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 17\n    }, this);\n  }\n\n}\n\nexport default GraphPage;","map":{"version":3,"sources":["/Users/tristanbilot/Desktop/Design4green/design4green/src/Components/GraphPage.js"],"names":["React","Component","GanttComponent","Inject","Selection","Toolbar","ExcelExport","PdfExport","ColumnsDirective","ColumnDirective","editingResources","DataFrame","GraphPage","constructor","props","state","dataframe","basket","columns","graph","graphLabels","taskbarWithColorBinded","taskbarWithColor","bind","taskBarColors","taskFields","id","name","startDate","endDate","duration","progress","dependency","child","resourceInfo","resourceFields","splitterSettings","columnIndex","projectStartDate","Date","projectNbDays","projectEndDate","now","gridLines","toolbar","timelineSettings","topTier","unit","format","bottomTier","labelSettings","rightLabel","componentWillMount","getGanttGraph","criterions","cycleLifeCategories","labels","day","baseXPosition","widthOfCycleLife","i","lastCycle","forEach","element","cycleLifeIndex","indexOf","cycle","begXPosition","getTime","endXPosition","node","TaskID","TaskName","useCase","StartDate","EndDate","subtasks","category","family","push","resourceId","resourceName","criterion","setState","getGanttInfoAsDataframe","ids","dfs","df","filter","row","get","select","totalDf","union","chain","translatePriorityToInteger","sortDataframe","priority","priorities","set","translateCycleLifeToInteger","cycleLife","withColumn","sortBy","timeout","delay","Promise","res","setTimeout","height","borderRadius","backgroundColor","taskData","textAlign","textOoverflow","overflow","color","fontSize","toolbarClick","args","item","ganttInstance","excelExport","csvExport","pdfExport","loadLegend","colors","elements","label","Object","entries","render","gantt"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { GanttComponent, Inject, Selection, Toolbar, ExcelExport, PdfExport, ColumnsDirective, ColumnDirective } from '@syncfusion/ej2-react-gantt';\nimport { editingResources } from './scripts/graph_data';\nimport DataFrame from \"dataframe-js\";\nimport './css/graph.css'\n\nclass GraphPage extends Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            dataframe: props.dataframe,\n            basket: props.basket,\n            columns: [],\n            graph: [],\n            graphLabels: [],\n          }\n\n        this.taskbarWithColorBinded = this.taskbarWithColor.bind(this)\n\n        this.taskBarColors = {\n            \"STRATEGIE\": \"#1b5e20\",\n            \"SPECIFICATIONS\": \"#00695c\",\n            \"UX/UI\": \"#0097a7\",\n            \"CONTENUS\": \"#039be5\",\n            \"ARCHITECTURE\": \"#2196f3\",\n            \"FRONTEND\": \"#5c6bc0\",\n            \"BACKEND\": \"#9575cd\",\n            \"HEBERGEMENT\": \"#ce93d8\",\n        }\n\n        this.taskFields = {\n            id: 'TaskID',\n            name: 'TaskName',\n            startDate: 'StartDate',\n            endDate: 'EndDate',\n            duration: 'Duration',\n            progress: 'Progress',\n            dependency: 'Predecessor',\n            child: 'subtasks',\n            resourceInfo: 'resources'\n        };\n        this.resourceFields = {\n            id: 'resourceId',\n            name: 'resourceName'\n        };\n        this.splitterSettings = {\n            columnIndex: 2\n        };\n        this.projectStartDate = new Date()\n        let projectNbDays = 40\n        this.projectEndDate = new Date(Date.now()+ (1000*60*60*24) * projectNbDays)\n        this.gridLines = 'Both';\n        this.toolbar = ['ExcelExport', 'CsvExport', 'PdfExport'];\n        this.timelineSettings = {\n            topTier: {\n                unit: 'Week',\n                format: 'MMM dd, y',\n            },\n            bottomTier: {\n                unit: 'Day',\n            },\n        };\n        this.labelSettings = {\n            // leftLabel: 'TaskName',\n            rightLabel: 'resources'\n        };\n    }\n\n    async componentWillMount() {\n        await this.getGanttGraph()\n    }\n\n    async getGanttGraph(criterions) {\n        if (this.state.dataframe == null)\n            return []\n\n        let cycleLifeCategories = [ 'Acquisition', 'Conception', 'Réalisation', 'Déploiement', 'Administration', \n            'Utilisation', 'Maintenance', 'Fin de Vie', 'Revalorisation' ]\n    \n        let graph = []\n        let labels = []\n        let day = 1000*60*60*24\n        let baseXPosition = this.projectStartDate\n        let widthOfCycleLife = 4\n        let i = 1\n        var lastCycle = null;\n\n        this.state.basket.forEach(element => {\n            let cycleLifeIndex = cycleLifeCategories.indexOf(element.cycle)\n            let begXPosition = new Date(baseXPosition.getTime() + (widthOfCycleLife * cycleLifeIndex) * day)\n            let endXPosition = new Date(baseXPosition.getTime() + (widthOfCycleLife * cycleLifeIndex) * day + widthOfCycleLife * day)\n    \n            let node = {\n                TaskID: i,\n                TaskName: element.useCase,\n                StartDate: begXPosition,\n                EndDate: endXPosition,\n                subtasks: [],\n                category: element.family,\n                useCase: element.useCase\n            }\n            if (lastCycle != null && lastCycle != element.cycle) {\n                node[\"Predecessor\"] = i - 1\n            }\n\n            graph.push(node)\n            lastCycle = element.cycle\n\n            labels.push({\n                resourceId: i++,\n                resourceName: element.criterion\n            })\n        })\n    \n        this.setState({\n            graph: graph,\n            graphLabels: labels,\n        })\n    }\n\n    getGanttInfoAsDataframe(ids) {\n        let dfs = []\n    \n        // for each id, fetch the required column infos \n        ids.forEach(id => {\n            let df = this.state.dataframe.filter(row => row\n            .get(\"ID\") === id)\n            .select(\"Famille d'origine\", \"CRITERES\", \"Etape Cycle de Vie\", \"incontournables\", \"Use Case\", \"JUSTIFICATIONS\", \"Priorité\");\n            dfs.push(df)\n        })\n        \n        // merge all the rows dataframes in one dataframe\n        let totalDf = new DataFrame([]);\n        dfs.forEach(df => {\n            totalDf = totalDf.union(df)\n        })\n    \n        // parse the priority to integers\n        totalDf = totalDf.chain(this.translatePriorityToInteger)\n        totalDf = this.sortDataframe(totalDf)\n        return totalDf\n    }\n\n    translatePriorityToInteger(row) {\n        let priority = row.get(\"Priorité\")\n        let priorities = {\n          \"Low\": 1,\n          \"Medium\": 2,\n          \"High\": 3,\n          \"\": 4,\n        }\n        row = row.set(\"Priorité\", priorities[priority])\n        return row\n    }\n\n    translateCycleLifeToInteger(row) {\n        let cycleLife = row.get(\"Etape Cycle de Vie\")\n        let priorities = [ 'Acquisition', 'Conception', 'Réalisation', 'Déploiement', 'Administration', \n         'Utilisation', 'Maintenance', 'Fin de Vie', 'Revalorisation' ]\n    \n         row = row.set(\"Cycle life priority\", priorities.indexOf(cycleLife))\n         return row\n      }\n\n    sortDataframe(df) {\n        // add a new colum with an integer representing the priority based on cycle life\n        df = df.withColumn(\"Cycle life priority\")\n        df = df.chain(this.translateCycleLifeToInteger)\n    \n        // sort first by priority and then by cycle life to make groups\n        df = df.sortBy(\"Priorité\")\n        df = df.sortBy(\"Cycle life priority\")\n        return df\n    }\n\n    timeout(delay) {\n        return new Promise( res => setTimeout(res, delay) );\n    }\n\n    taskbarWithColor(props) {\n        return (\n        <div className=\"e-gantt-child-taskbar e-custom-moments\" style={{ height: \"100%\", borderRadius: \"5px\", backgroundColor:this.taskBarColors[props.taskData.category], textAlign: \"center\" }}>\n            <div>\n              <span className=\"e-task-label\" style={{textOoverflow: \"ellipsis\", height: \"90%\", overflow: \"hidden\", color: \"white\", fontSize: \"10px\" }}>{props.taskData.useCase}</span>\n            </div>\n        </div>)\n    }\n\n    toolbarClick(args) {\n        if (args.item.id === \"GanttExport_excelexport\") {\n            this.ganttInstance.excelExport();\n        }\n        else if (args.item.id === \"GanttExport_csvexport\") {\n            this.ganttInstance.csvExport();\n        }\n        else if (args.item.id === \"GanttExport_pdfexport\") {\n            this.ganttInstance.pdfExport();\n        }\n    }\n\n    loadLegend() {\n        let colors = { \"STRATEGIE\": \"#1b5e20\",\n            \"SPECIFICATIONS\": \"#00695c\",\n            \"UX/UI\": \"#0097a7\",\n            \"CONTENUS\": \"#039be5\",\n            \"ARCHITECTURE\": \"#2196f3\",\n            \"FRONTEND\": \"#5c6bc0\",\n            \"BACKEND\": \"#9575cd\",\n            \"HEBERGEMENT\": \"#ce93d8\",\n        }\n        let elements = []\n        for (const [label, color] of Object.entries(colors)) {\n            elements.push(\n                <div className=\"row\">\n                    <div className=\"col legend\" style={{backgroundColor: color}}></div>\n                    <div className=\"col\">{label}</div>\n                </div>\n            )\n        }\n        return elements\n    }\n\n    render() {\n        return (<div className='control-pane'>\n        <div>\n        <h2 className=\"margin30\">Gantt planning</h2>\n            <div className='control-section'>\n            <GanttComponent id='GanttExport' ref={gantt => this.ganttInstance = gantt} height='700px' rowHeight={45} taskbarHeight={35} dataSource={this.state.graph} dateFormat={'MMM dd, y'} treeColumnIndex={1} allowExcelExport={true} allowPdfExport={true} allowSelection={true} showColumnMenu={false} highlightWeekends={true} allowUnscheduledTasks={true} projectStartDate={this.projectStartDate} projectEndDate={this.projectEndDate} splitterSettings={this.splitterSettings} taskFields={this.taskFields} timelineSettings={this.timelineSettings} labelSettings={this.labelSettings} toolbarClick={this.toolbarClick.bind(this)} height='410px' gridLines={this.gridLines} toolbar={this.toolbar} resourceFields={this.resourceFields} resources={editingResources} taskbarTemplate={this.taskbarWithColorBinded}>\n                <ColumnsDirective>\n                <ColumnDirective field='TaskID' width='60'></ColumnDirective>\n                <ColumnDirective field='TaskName' width='250'></ColumnDirective>\n                <ColumnDirective field='StartDate'></ColumnDirective>\n                <ColumnDirective field='EndDate'></ColumnDirective>\n                <ColumnDirective field='Duration'></ColumnDirective>\n                <ColumnDirective field='Predecessor'></ColumnDirective>\n                <ColumnDirective field='resources'></ColumnDirective>\n                <ColumnDirective field='Progress'></ColumnDirective>\n                </ColumnsDirective>\n                <Inject services={[Selection, Toolbar, ExcelExport, PdfExport]}/>\n            </GanttComponent>\n            </div>\n            <div className=\"margin30\">\n            <h3>Legend</h3>\n                { this.loadLegend() }\n                <div className=\"legend\"></div>\n            </div>\n        </div>\n      </div>);\n    }\n}\n\nexport default GraphPage;"]},"metadata":{},"sourceType":"module"}