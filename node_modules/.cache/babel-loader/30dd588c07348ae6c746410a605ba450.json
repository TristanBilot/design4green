{"ast":null,"code":"import * as events from '../base/constant';\nimport { isNullOrUndefined, closest, attributes, removeClass, addClass, Browser, detach } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { HTMLFormatter } from '../formatter/html-formatter';\nimport { RenderType } from '../base/enum';\nimport * as classes from '../base/classes';\nimport { HtmlToolbarStatus } from './html-toolbar-status';\nimport { IframeContentRender } from '../renderer/iframe-content-renderer';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { ColorPickerInput } from './color-picker';\nimport { NodeSelection } from '../../selection/selection';\nimport { InsertHtml } from '../../editor-manager/plugin/inserthtml';\nimport { getTextNodesUnder, sanitizeHelper, getDefaultValue } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { XhtmlValidation } from './xhtml-validation';\nimport { ON_BEGIN } from './../../common/constant';\n/**\n * `HtmlEditor` module is used to HTML editor\n */\n\nvar HtmlEditor =\n/** @class */\nfunction () {\n  function HtmlEditor(parent, serviceLocator) {\n    this.rangeCollection = [];\n    this.parent = parent;\n    this.locator = serviceLocator;\n    this.renderFactory = this.locator.getService('rendererFactory');\n    this.xhtmlValidation = new XhtmlValidation(parent);\n    this.addEventListener();\n  }\n  /**\n   * Destroys the Markdown.\n   *\n   * @function destroy\n   * @returns {void}\n   * @hidden\n    */\n\n\n  HtmlEditor.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n  /**\n   * @param {string} value - specifies the string value\n   * @returns {void}\n   * @hidden\n    */\n\n\n  HtmlEditor.prototype.sanitizeHelper = function (value) {\n    value = sanitizeHelper(value, this.parent);\n    return value;\n  };\n\n  HtmlEditor.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.nodeSelectionObj = new NodeSelection();\n    this.colorPickerModule = new ColorPickerInput(this.parent, this.locator);\n    this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n    this.parent.on(events.htmlToolbarClick, this.onToolbarClick, this);\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.renderColorPicker, this.renderColorPicker, this);\n    this.parent.on(events.initialEnd, this.render, this);\n    this.parent.on(events.modelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.destroy, this.destroy, this);\n    this.parent.on(events.selectAll, this.selectAll, this);\n    this.parent.on(events.selectRange, this.selectRange, this);\n    this.parent.on(events.getSelectedHtml, this.getSelectedHtml, this);\n    this.parent.on(events.selectionSave, this.onSelectionSave, this);\n    this.parent.on(events.selectionRestore, this.onSelectionRestore, this);\n    this.parent.on(events.readOnlyMode, this.updateReadOnly, this);\n    this.parent.on(events.paste, this.onPaste, this);\n  };\n\n  HtmlEditor.prototype.updateReadOnly = function () {\n    if (this.parent.readonly) {\n      attributes(this.parent.contentModule.getEditPanel(), {\n        contenteditable: 'false'\n      });\n      addClass([this.parent.element], classes.CLS_RTE_READONLY);\n    } else {\n      attributes(this.parent.contentModule.getEditPanel(), {\n        contenteditable: 'true'\n      });\n      removeClass([this.parent.element], classes.CLS_RTE_READONLY);\n    }\n  };\n\n  HtmlEditor.prototype.onSelectionSave = function () {\n    var currentDocument = this.contentRenderer.getDocument();\n    var range = this.nodeSelectionObj.getRange(currentDocument);\n    this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n  };\n\n  HtmlEditor.prototype.onSelectionRestore = function (e) {\n    this.parent.isBlur = false;\n    this.contentRenderer.getEditPanel().focus();\n\n    if (isNullOrUndefined(e.items) || e.items) {\n      this.saveSelection.restore();\n    }\n  };\n\n  HtmlEditor.prototype.onKeyUp = function (e) {\n    var args = e.args;\n    var restrictKeys = [8, 9, 13, 16, 17, 18, 20, 27, 37, 38, 39, 40, 44, 45, 46, 91, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123];\n    var range = this.parent.getRange();\n    var regEx = new RegExp(String.fromCharCode(8203), 'g');\n    var pointer;\n\n    if (restrictKeys.indexOf(args.keyCode) < 0 && !args.shiftKey && !args.ctrlKey && !args.altKey) {\n      if (range.startContainer.textContent.charCodeAt(0) === 8203) {\n        pointer = range.startOffset - 1;\n        range.startContainer.textContent = range.startContainer.textContent.replace(regEx, '');\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n      }\n\n      if (!isNOU(range.startContainer.previousSibling) && !isNOU(range.startContainer.previousSibling.parentElement) && range.startContainer.parentElement === range.startContainer.previousSibling.parentElement && range.startContainer.previousSibling.textContent.charCodeAt(0) === 8203) {\n        range.startContainer.previousSibling.textContent = range.startContainer.previousSibling.textContent.replace(regEx, '');\n      }\n\n      if (range.endContainer.textContent.charCodeAt(range.endOffset) === 8203) {\n        pointer = range.startOffset;\n        range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n      }\n    }\n  };\n\n  HtmlEditor.prototype.onKeyDown = function (e) {\n    var _this = this;\n\n    var currentRange;\n    var args = e.args;\n\n    if (Browser.info.name === 'chrome') {\n      currentRange = this.parent.getRange();\n      this.backSpaceCleanup(e, currentRange);\n      this.deleteCleanup(e, currentRange);\n    }\n\n    if (args.keyCode === 9 && this.parent.enableTabKey) {\n      if (!isNOU(args.target) && isNullOrUndefined(closest(args.target, '.e-rte-toolbar'))) {\n        var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n        var parentNode = this.nodeSelectionObj.getParentNodeCollection(range);\n\n        if (!((parentNode[0].nodeName === 'LI' || closest(parentNode[0], 'li') || closest(parentNode[0], 'table')) && range.startOffset === 0)) {\n          args.preventDefault();\n\n          if (!args.shiftKey) {\n            InsertHtml.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;');\n            this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));\n          } else if (this.rangeCollection.length > 0 && this.rangeCollection[this.rangeCollection.length - 1].startContainer.textContent.length === 4) {\n            var textCont = this.rangeCollection[this.rangeCollection.length - 1].startContainer;\n            this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(), textCont, textCont, 0, textCont.textContent.length);\n            InsertHtml.Insert(this.contentRenderer.getDocument(), document.createTextNode(''));\n            this.rangeCollection.pop();\n          }\n        }\n      }\n    }\n\n    if (e.args.action === 'space' || e.args.action === 'enter' || e.args.keyCode === 13) {\n      this.spaceLink(e.args);\n\n      if (this.parent.editorMode === 'HTML' && !(this.parent.shiftEnterKey === 'BR' && e.args.shiftKey)) {\n        this.parent.notify(events.enterHandler, {\n          args: e.args\n        });\n      }\n    }\n\n    if (e.args.action === 'space') {\n      var currentRange_1 = this.parent.getRange();\n      var editorValue = currentRange_1.startContainer.textContent.slice(0, currentRange_1.startOffset);\n      var orderedList_1 = this.isOrderedList(editorValue);\n      var unOrderedList = this.isUnOrderedList(editorValue);\n\n      if (orderedList_1 && !unOrderedList || unOrderedList && !orderedList_1) {\n        var eventArgs_1 = {\n          callBack: null,\n          event: e.args,\n          name: 'keydown-handler'\n        };\n        var actionBeginArgs = {\n          cancel: false,\n          item: {\n            command: 'Lists',\n            subCommand: orderedList_1 ? 'OL' : 'UL'\n          },\n          name: 'actionBegin',\n          originalEvent: e.args,\n          requestType: orderedList_1 ? 'OL' : 'UL'\n        };\n        this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n          if (!actionBeginArgs.cancel) {\n            _this.parent.formatter.editorManager.observer.notify(ON_BEGIN, eventArgs_1);\n\n            _this.parent.trigger(events.actionComplete, {\n              editorMode: _this.parent.editorMode,\n              elements: _this.parent.formatter.editorManager.domNode.blockNodes(),\n              event: e.args,\n              name: events.actionComplete,\n              range: _this.parent.getRange(),\n              requestType: orderedList_1 ? 'OL' : 'UL'\n            });\n          }\n        });\n      }\n    }\n\n    if (Browser.info.name === 'chrome' && (!isNullOrUndefined(this.rangeElement) && !isNullOrUndefined(this.oldRangeElement) || !isNullOrUndefined(this.deleteRangeElement) && !isNullOrUndefined(this.deleteOldRangeElement)) && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.rangeElement = null;\n      this.oldRangeElement = null;\n      this.deleteRangeElement = null;\n      this.deleteOldRangeElement = null;\n      args.preventDefault();\n    }\n  };\n\n  HtmlEditor.prototype.isOrderedList = function (editorValue) {\n    editorValue = editorValue.replace(/\\u200B/g, '');\n    var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n\n    if (!isNullOrUndefined(editorValue)) {\n      for (var i = 0; i < olListStartRegex.length; i++) {\n        if (olListStartRegex[i].test(editorValue)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  HtmlEditor.prototype.isUnOrderedList = function (editorValue) {\n    editorValue = editorValue.replace(/\\u200B/g, '');\n    var ulListStartRegex = [/^[*]$/, /^[-]$/];\n\n    if (!isNullOrUndefined(editorValue)) {\n      for (var i = 0; i < ulListStartRegex.length; i++) {\n        if (ulListStartRegex[i].test(editorValue)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  HtmlEditor.prototype.backSpaceCleanup = function (e, currentRange) {\n    var isLiElement = false;\n\n    if (e.args.code === 'Backspace' && e.args.keyCode === 8 && currentRange.startOffset === 0 && currentRange.endOffset === 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.textContent.length > 0 && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.rangeElement = this.getRootBlockNode(currentRange.startContainer);\n\n      if (this.rangeElement.tagName === 'OL' || this.rangeElement.tagName === 'UL') {\n        var liElement = this.getRangeLiNode(currentRange.startContainer);\n\n        if (liElement.previousElementSibling && liElement.previousElementSibling.childElementCount > 0) {\n          this.oldRangeElement = liElement.previousElementSibling.lastElementChild;\n\n          if (!isNullOrUndefined(liElement.lastElementChild)) {\n            this.rangeElement = liElement.lastElementChild;\n            isLiElement = true;\n          } else {\n            this.rangeElement = liElement;\n          }\n        }\n      } else if (this.rangeElement.tagName === 'TABLE' || !isNullOrUndefined(this.rangeElement.previousElementSibling) && this.rangeElement.previousElementSibling.tagName === 'TABLE') {\n        return;\n      } else {\n        this.oldRangeElement = this.rangeElement.previousElementSibling;\n      }\n\n      if (isNullOrUndefined(this.oldRangeElement)) {\n        return;\n      } else {\n        if (this.oldRangeElement.tagName === 'OL' || this.oldRangeElement.tagName === 'UL') {\n          this.oldRangeElement = this.oldRangeElement.lastElementChild.lastElementChild ? this.oldRangeElement.lastElementChild.lastElementChild : this.oldRangeElement.lastElementChild;\n        }\n\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), // eslint-disable-next-line\n        this.oldRangeElement, this.oldRangeElement.childNodes.length);\n\n        if (this.oldRangeElement.querySelector('BR')) {\n          detach(this.oldRangeElement.querySelector('BR'));\n        }\n\n        if (!isNullOrUndefined(this.rangeElement) && this.oldRangeElement !== this.rangeElement) {\n          while (this.rangeElement.firstChild) {\n            this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);\n          } // eslint-disable-next-line\n\n\n          !isLiElement ? detach(this.rangeElement) : detach(this.rangeElement.parentElement);\n          this.oldRangeElement.normalize();\n        }\n      }\n    }\n  };\n\n  HtmlEditor.prototype.deleteCleanup = function (e, currentRange) {\n    var isLiElement = false;\n    var liElement;\n    var rootElement;\n\n    if (e.args.code === 'Delete' && e.args.keyCode === 46 && this.parent.contentModule.getText().trim().length !== 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.deleteRangeElement = rootElement = this.getRootBlockNode(currentRange.startContainer);\n\n      if (this.deleteRangeElement.tagName === 'OL' || this.deleteRangeElement.tagName === 'UL') {\n        liElement = this.getRangeLiNode(currentRange.startContainer);\n\n        if (liElement.nextElementSibling && liElement.nextElementSibling.childElementCount > 0 && !liElement.nextElementSibling.querySelector('BR')) {\n          if (!isNullOrUndefined(liElement.lastElementChild)) {\n            this.deleteRangeElement = liElement.lastElementChild;\n            isLiElement = true;\n          } else {\n            this.deleteRangeElement = liElement;\n          }\n        } else {\n          this.deleteRangeElement = this.getRangeElement(liElement);\n        }\n      } else if (this.deleteRangeElement.nodeType === 3 || this.deleteRangeElement.tagName === 'TABLE' || !isNullOrUndefined(this.deleteRangeElement.nextElementSibling) && this.deleteRangeElement.nextElementSibling.tagName === 'TABLE') {\n        return;\n      }\n\n      if (this.getCaretIndex(currentRange, this.deleteRangeElement) === this.deleteRangeElement.textContent.length) {\n        if (!isNullOrUndefined(liElement)) {\n          if (isLiElement || !isNullOrUndefined(liElement.nextElementSibling)) {\n            this.deleteOldRangeElement = this.getRangeElement(liElement.nextElementSibling);\n          } else {\n            this.deleteOldRangeElement = rootElement.nextElementSibling;\n          }\n        } else {\n          this.deleteOldRangeElement = this.deleteRangeElement.nextElementSibling;\n        }\n\n        if (isNullOrUndefined(this.deleteOldRangeElement)) {\n          return;\n        } else {\n          this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement.childNodes.length);\n\n          if (this.deleteRangeElement.querySelector('BR')) {\n            detach(this.deleteRangeElement.querySelector('BR'));\n          }\n\n          if (!isNullOrUndefined(this.deleteRangeElement) && this.deleteOldRangeElement.tagName !== 'OL' && this.deleteOldRangeElement.tagName !== 'UL' && this.deleteOldRangeElement !== this.deleteRangeElement) {\n            while (this.deleteOldRangeElement.firstChild) {\n              this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);\n            }\n\n            if (!isLiElement) {\n              detach(this.deleteOldRangeElement);\n            } else {\n              detach(this.deleteOldRangeElement.parentElement);\n            }\n\n            this.deleteRangeElement.normalize();\n          } else {\n            this.deleteRangeElement = null;\n            this.deleteOldRangeElement = null;\n          }\n        }\n      } else {\n        this.deleteRangeElement = null;\n      }\n    }\n  };\n\n  HtmlEditor.prototype.getCaretIndex = function (currentRange, element) {\n    var position = 0;\n\n    if (this.parent.contentModule.getDocument().getSelection().rangeCount !== 0) {\n      var preCaretRange = currentRange.cloneRange();\n      preCaretRange.selectNodeContents(element);\n      preCaretRange.setEnd(currentRange.endContainer, currentRange.endOffset);\n      position = preCaretRange.toString().length;\n    }\n\n    return position;\n  };\n\n  HtmlEditor.prototype.getRangeElement = function (element) {\n    var rangeElement = element.lastElementChild ? element.lastElementChild.tagName === 'BR' ? element.lastElementChild.previousElementSibling ? element.lastElementChild.previousElementSibling : element : element.lastElementChild : element;\n    return rangeElement;\n  };\n\n  HtmlEditor.prototype.getRootBlockNode = function (rangeBlockNode) {\n    // eslint-disable-next-line\n    for (; rangeBlockNode && this.parent && this.parent.inputElement !== rangeBlockNode; rangeBlockNode = rangeBlockNode) {\n      if (rangeBlockNode.parentElement === this.parent.inputElement) {\n        break;\n      } else {\n        rangeBlockNode = rangeBlockNode.parentElement;\n      }\n    }\n\n    return rangeBlockNode;\n  };\n\n  HtmlEditor.prototype.getRangeLiNode = function (rangeLiNode) {\n    var node = rangeLiNode.parentElement;\n\n    while (node !== this.parent.inputElement) {\n      if (node.nodeType === 1 && node.tagName === 'LI') {\n        break;\n      }\n\n      node = node.parentElement;\n    }\n\n    return node;\n  };\n\n  HtmlEditor.prototype.onPaste = function (e) {\n    // eslint-disable-next-line\n    var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n\n    if (e.text.match(regex)) {\n      if (e.isWordPaste) {\n        return;\n      }\n\n      e.args.preventDefault();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()); // eslint-disable-next-line\n\n      var saveSelection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument()); // eslint-disable-next-line\n\n      var httpRegex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)))/gi);\n      var wwwRegex = new RegExp(/([^\\S]|^)(((www\\.))(\\S+))/gi);\n      var enterSplitText = e.text.split('\\n');\n      var contentInnerElem = '';\n\n      for (var i = 0; i < enterSplitText.length; i++) {\n        if (enterSplitText[i].trim() === '') {\n          contentInnerElem += getDefaultValue(this.parent);\n        } else {\n          var contentWithSpace = '';\n          var spaceBetweenContent = true;\n          var spaceSplit = enterSplitText[i].split(' ');\n\n          for (var j = 0; j < spaceSplit.length; j++) {\n            if (spaceSplit[j].trim() === '') {\n              contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n            } else {\n              spaceBetweenContent = false;\n              contentWithSpace += spaceSplit[j] + ' ';\n            }\n          }\n\n          if (i === 0) {\n            contentInnerElem += '<span>' + contentWithSpace.trim() + '</span>';\n          } else {\n            contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n          }\n        }\n      }\n\n      var divElement = this.parent.createElement('div');\n      divElement.setAttribute('class', 'pasteContent');\n      divElement.style.display = 'inline';\n      divElement.innerHTML = contentInnerElem;\n      var paraElem = divElement.querySelectorAll('span, p');\n\n      for (var i = 0; i < paraElem.length; i++) {\n        var splitTextContent = paraElem[i].innerHTML.split(' ');\n        var resultSplitContent = '';\n\n        for (var j = 0; j < splitTextContent.length; j++) {\n          if (splitTextContent[j].match(httpRegex) || splitTextContent[j].match(wwwRegex)) {\n            resultSplitContent += '<a className=\"e-rte-anchor\" href=\"' + splitTextContent[j] + '\" title=\"' + splitTextContent[j] + '\"target=\"_blank\">' + splitTextContent[j] + ' </a>';\n          } else {\n            resultSplitContent += splitTextContent[j] + ' ';\n          }\n        }\n\n        paraElem[i].innerHTML = resultSplitContent.trim();\n      }\n\n      if (!isNullOrUndefined(this.parent.pasteCleanupModule)) {\n        e.callBack(divElement.innerHTML);\n      } else {\n        this.parent.formatter.editorManager.execCommand('insertHTML', null, null, null, divElement);\n      }\n    }\n  };\n\n  HtmlEditor.prototype.spaceLink = function (e) {\n    var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n    var selectNodeEle = this.nodeSelectionObj.getParentNodeCollection(range);\n    var text = range.startContainer.textContent.substr(0, range.endOffset);\n    var splitText = text.split(' ');\n    var urlText = splitText[splitText.length - 1];\n    var urlTextRange = range.startOffset - (text.length - splitText[splitText.length - 1].length);\n    urlText = urlText.slice(0, urlTextRange); // eslint-disable-next-line\n\n    var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n\n    if (selectNodeEle[0].nodeName !== 'A' && urlText.match(regex)) {\n      var selection = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n      var url = urlText.indexOf('http') > -1 ? urlText : 'http://' + urlText;\n      var selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      var value = {\n        url: url,\n        selection: selection,\n        selectParent: selectParent,\n        text: urlText,\n        title: '',\n        target: '_blank'\n      };\n      this.parent.formatter.process(this.parent, {\n        item: {\n          'command': 'Links',\n          'subCommand': 'CreateLink'\n        }\n      }, e, value);\n    }\n  };\n\n  HtmlEditor.prototype.onToolbarClick = function (args) {\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    var item = args.item;\n    var closestElement = closest(args.originalEvent.target, '.e-rte-quick-popup');\n\n    if (closestElement && !closestElement.classList.contains('e-rte-inline-popup')) {\n      if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' || item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n        if (isIDevice() && item.command === 'Images') {\n          this.nodeSelectionObj.restore();\n        }\n\n        var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n        save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n        selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n        selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n      }\n\n      if (item.command === 'Images') {\n        this.parent.notify(events.imageToolbarAction, {\n          member: 'image',\n          args: args,\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle\n        });\n      }\n\n      if (item.command === 'Links') {\n        this.parent.notify(events.linkToolbarAction, {\n          member: 'link',\n          args: args,\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle\n        });\n      }\n\n      if (item.command === 'Table') {\n        this.parent.notify(events.tableToolbarAction, {\n          member: 'table',\n          args: args,\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle\n        });\n      }\n    } else {\n      var linkDialog = document.getElementById(this.parent.getID() + '_rtelink');\n      var imageDialog = document.getElementById(this.parent.getID() + '_image');\n\n      if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' || item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n        var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n\n        if (isNullOrUndefined(linkDialog) && isNullOrUndefined(imageDialog)) {\n          save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n        }\n\n        selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n        selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n      }\n\n      switch (item.subCommand) {\n        case 'Maximize':\n          this.parent.notify(events.enableFullScreen, {\n            args: args\n          });\n          break;\n\n        case 'Minimize':\n          this.parent.notify(events.disableFullScreen, {\n            args: args\n          });\n          break;\n\n        case 'CreateLink':\n          this.parent.notify(events.insertLink, {\n            member: 'link',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n\n        case 'RemoveLink':\n          this.parent.notify(events.unLink, {\n            member: 'link',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n\n        case 'Print':\n          this.parent.print();\n          break;\n\n        case 'Image':\n          this.parent.notify(events.insertImage, {\n            member: 'image',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n\n        case 'CreateTable':\n          this.parent.notify(events.createTable, {\n            member: 'table',\n            args: args,\n            selection: save\n          });\n          break;\n\n        case 'SourceCode':\n          this.parent.notify(events.sourceCode, {\n            member: 'viewSource',\n            args: args\n          });\n          break;\n\n        case 'Preview':\n          this.parent.notify(events.updateSource, {\n            member: 'updateSource',\n            args: args\n          });\n          break;\n\n        case 'FontColor':\n        case 'BackgroundColor':\n          break;\n\n        case 'File':\n          this.parent.notify(events.renderFileManager, {\n            member: 'fileManager',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n\n        default:\n          this.parent.formatter.process(this.parent, args, args.originalEvent, null);\n          break;\n      }\n    }\n  };\n\n  HtmlEditor.prototype.renderColorPicker = function (args) {\n    this.colorPickerModule.renderColorPickerInput(args);\n  };\n\n  HtmlEditor.prototype.instantiateRenderer = function () {\n    if (this.parent.iframeSettings.enable) {\n      this.renderFactory.addRenderer(RenderType.Content, new IframeContentRender(this.parent, this.locator));\n    } else {\n      this.renderFactory.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n    }\n  };\n\n  HtmlEditor.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.initialEnd, this.render);\n    this.parent.off(events.modelChanged, this.onPropertyChanged);\n    this.parent.off(events.htmlToolbarClick, this.onToolbarClick);\n    this.parent.off(events.renderColorPicker, this.renderColorPicker);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.initialLoad, this.instantiateRenderer);\n    this.parent.off(events.selectAll, this.selectAll);\n    this.parent.off(events.selectRange, this.selectRange);\n    this.parent.off(events.getSelectedHtml, this.getSelectedHtml);\n    this.parent.off(events.selectionSave, this.onSelectionSave);\n    this.parent.off(events.selectionRestore, this.onSelectionRestore);\n    this.parent.off(events.readOnlyMode, this.updateReadOnly);\n    this.parent.off(events.paste, this.onPaste);\n  };\n\n  HtmlEditor.prototype.render = function () {\n    this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n    var editElement = this.contentRenderer.getEditPanel();\n    var option = {\n      undoRedoSteps: this.parent.undoRedoSteps,\n      undoRedoTimer: this.parent.undoRedoTimer\n    };\n\n    if (isNullOrUndefined(this.parent.formatter)) {\n      var formatterClass = new HTMLFormatter({\n        currentDocument: this.contentRenderer.getDocument(),\n        element: editElement,\n        options: option\n      });\n      this.parent.setProperties({\n        formatter: formatterClass\n      }, true);\n    } else {\n      this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n    }\n\n    if (this.parent.enableXhtml) {\n      this.parent.notify(events.xhtmlValidation, {});\n    }\n\n    if (this.parent.toolbarSettings.enable) {\n      this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n    }\n\n    if (this.parent.inlineMode.enable) {\n      if (!isNullOrUndefined(this.parent.fontFamily.default)) {\n        editElement.style.fontFamily = this.parent.fontFamily.default;\n      }\n\n      if (!isNullOrUndefined(this.parent.fontSize.default)) {\n        editElement.style.fontSize = this.parent.fontSize.default;\n      }\n    }\n\n    this.parent.notify(events.bindOnEnd, {});\n  };\n  /**\n   * Called internally if any of the property value changed.\n   *\n   * @param {RichTextEditorModel} e - specifies the editor model\n   * @returns {void}\n   * @hidden\n    */\n\n\n  HtmlEditor.prototype.onPropertyChanged = function (e) {\n    // On property code change here\n    if (!isNullOrUndefined(e.newProp.formatter)) {\n      var editElement = this.contentRenderer.getEditPanel();\n      var option = {\n        undoRedoSteps: this.parent.undoRedoSteps,\n        undoRedoTimer: this.parent.undoRedoTimer\n      };\n      this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n    }\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {string} - returns the string value\n   * @hidden\n   */\n\n\n  HtmlEditor.prototype.getModuleName = function () {\n    return 'htmlEditor';\n  };\n  /**\n   * For selecting all content in RTE\n   *\n   * @returns {void}\n   * @private\n   * @hidden\n   */\n\n\n  HtmlEditor.prototype.selectAll = function () {\n    var nodes = getTextNodesUnder(this.parent.contentModule.getDocument(), this.parent.contentModule.getEditPanel());\n\n    if (nodes.length > 0) {\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), nodes[0], nodes[nodes.length - 1], 0, nodes[nodes.length - 1].textContent.length);\n    }\n  };\n  /**\n   * For selecting all content in RTE\n   *\n   * @param {NotifyArgs} e - specifies the notified arguments\n   * @returns {void}\n   * @private\n   * @hidden\n   */\n\n\n  HtmlEditor.prototype.selectRange = function (e) {\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(), e.range);\n  };\n  /**\n   * For get a selected text in RTE\n   *\n   * @param {NotifyArgs} e - specifies the notified arguments\n   * @returns {void}\n   * @hidden\n   */\n\n\n  HtmlEditor.prototype.getSelectedHtml = function (e) {\n    e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString());\n  };\n\n  return HtmlEditor;\n}();\n\nexport { HtmlEditor };","map":{"version":3,"sources":["/Users/tristanbilot/Desktop/Design4green/design4green/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/actions/html-editor.js"],"names":["events","isNullOrUndefined","closest","attributes","removeClass","addClass","Browser","detach","isNOU","HTMLFormatter","RenderType","classes","HtmlToolbarStatus","IframeContentRender","ContentRender","ColorPickerInput","NodeSelection","InsertHtml","getTextNodesUnder","sanitizeHelper","getDefaultValue","isIDevice","XhtmlValidation","ON_BEGIN","HtmlEditor","parent","serviceLocator","rangeCollection","locator","renderFactory","getService","xhtmlValidation","addEventListener","prototype","destroy","removeEventListener","value","isDestroyed","nodeSelectionObj","colorPickerModule","on","initialLoad","instantiateRenderer","htmlToolbarClick","onToolbarClick","keyDown","onKeyDown","keyUp","onKeyUp","renderColorPicker","initialEnd","render","modelChanged","onPropertyChanged","selectAll","selectRange","getSelectedHtml","selectionSave","onSelectionSave","selectionRestore","onSelectionRestore","readOnlyMode","updateReadOnly","paste","onPaste","readonly","contentModule","getEditPanel","contenteditable","element","CLS_RTE_READONLY","currentDocument","contentRenderer","getDocument","range","getRange","saveSelection","save","e","isBlur","focus","items","restore","args","restrictKeys","regEx","RegExp","String","fromCharCode","pointer","indexOf","keyCode","shiftKey","ctrlKey","altKey","startContainer","textContent","charCodeAt","startOffset","replace","formatter","editorManager","nodeSelection","setCursorPoint","previousSibling","parentElement","endContainer","endOffset","_this","currentRange","info","name","backSpaceCleanup","deleteCleanup","enableTabKey","target","parentNode","getParentNodeCollection","nodeName","preventDefault","Insert","push","length","textCont","setSelectionText","document","createTextNode","pop","action","spaceLink","editorMode","shiftEnterKey","notify","enterHandler","currentRange_1","editorValue","slice","orderedList_1","isOrderedList","unOrderedList","isUnOrderedList","eventArgs_1","callBack","event","actionBeginArgs","cancel","item","command","subCommand","originalEvent","requestType","trigger","actionBegin","observer","actionComplete","elements","domNode","blockNodes","rangeElement","oldRangeElement","deleteRangeElement","deleteOldRangeElement","tagName","olListStartRegex","i","test","ulListStartRegex","isLiElement","code","getSelection","getRootBlockNode","liElement","getRangeLiNode","previousElementSibling","childElementCount","lastElementChild","childNodes","querySelector","firstChild","appendChild","normalize","rootElement","getText","trim","nextElementSibling","getRangeElement","nodeType","getCaretIndex","position","rangeCount","preCaretRange","cloneRange","selectNodeContents","setEnd","toString","rangeBlockNode","inputElement","rangeLiNode","node","regex","text","match","isWordPaste","httpRegex","wwwRegex","enterSplitText","split","contentInnerElem","contentWithSpace","spaceBetweenContent","spaceSplit","j","divElement","createElement","setAttribute","style","display","innerHTML","paraElem","querySelectorAll","splitTextContent","resultSplitContent","pasteCleanupModule","execCommand","selectNodeEle","substr","splitText","urlText","urlTextRange","selection","url","selectParent","title","process","selectParentEle","closestElement","classList","contains","getNodeCollection","imageToolbarAction","member","selectNode","linkToolbarAction","tableToolbarAction","linkDialog","getElementById","getID","imageDialog","enableFullScreen","disableFullScreen","insertLink","unLink","print","insertImage","createTable","sourceCode","updateSource","renderFileManager","renderColorPickerInput","iframeSettings","enable","addRenderer","Content","off","getRenderer","editElement","option","undoRedoSteps","undoRedoTimer","formatterClass","options","setProperties","updateFormatter","enableXhtml","toolbarSettings","toolbarUpdate","inlineMode","fontFamily","default","fontSize","bindOnEnd","newProp","getModuleName","nodes","setRange"],"mappings":"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","sourcesContent":["import * as events from '../base/constant';\nimport { isNullOrUndefined, closest, attributes, removeClass, addClass, Browser, detach } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { HTMLFormatter } from '../formatter/html-formatter';\nimport { RenderType } from '../base/enum';\nimport * as classes from '../base/classes';\nimport { HtmlToolbarStatus } from './html-toolbar-status';\nimport { IframeContentRender } from '../renderer/iframe-content-renderer';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { ColorPickerInput } from './color-picker';\nimport { NodeSelection } from '../../selection/selection';\nimport { InsertHtml } from '../../editor-manager/plugin/inserthtml';\nimport { getTextNodesUnder, sanitizeHelper, getDefaultValue } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { XhtmlValidation } from './xhtml-validation';\nimport { ON_BEGIN } from './../../common/constant';\n/**\n * `HtmlEditor` module is used to HTML editor\n */\nvar HtmlEditor = /** @class */ (function () {\n    function HtmlEditor(parent, serviceLocator) {\n        this.rangeCollection = [];\n        this.parent = parent;\n        this.locator = serviceLocator;\n        this.renderFactory = this.locator.getService('rendererFactory');\n        this.xhtmlValidation = new XhtmlValidation(parent);\n        this.addEventListener();\n    }\n    /**\n     * Destroys the Markdown.\n     *\n     * @function destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    /**\n     * @param {string} value - specifies the string value\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.sanitizeHelper = function (value) {\n        value = sanitizeHelper(value, this.parent);\n        return value;\n    };\n    HtmlEditor.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.nodeSelectionObj = new NodeSelection();\n        this.colorPickerModule = new ColorPickerInput(this.parent, this.locator);\n        this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n        this.parent.on(events.htmlToolbarClick, this.onToolbarClick, this);\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.renderColorPicker, this.renderColorPicker, this);\n        this.parent.on(events.initialEnd, this.render, this);\n        this.parent.on(events.modelChanged, this.onPropertyChanged, this);\n        this.parent.on(events.destroy, this.destroy, this);\n        this.parent.on(events.selectAll, this.selectAll, this);\n        this.parent.on(events.selectRange, this.selectRange, this);\n        this.parent.on(events.getSelectedHtml, this.getSelectedHtml, this);\n        this.parent.on(events.selectionSave, this.onSelectionSave, this);\n        this.parent.on(events.selectionRestore, this.onSelectionRestore, this);\n        this.parent.on(events.readOnlyMode, this.updateReadOnly, this);\n        this.parent.on(events.paste, this.onPaste, this);\n    };\n    HtmlEditor.prototype.updateReadOnly = function () {\n        if (this.parent.readonly) {\n            attributes(this.parent.contentModule.getEditPanel(), { contenteditable: 'false' });\n            addClass([this.parent.element], classes.CLS_RTE_READONLY);\n        }\n        else {\n            attributes(this.parent.contentModule.getEditPanel(), { contenteditable: 'true' });\n            removeClass([this.parent.element], classes.CLS_RTE_READONLY);\n        }\n    };\n    HtmlEditor.prototype.onSelectionSave = function () {\n        var currentDocument = this.contentRenderer.getDocument();\n        var range = this.nodeSelectionObj.getRange(currentDocument);\n        this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n    };\n    HtmlEditor.prototype.onSelectionRestore = function (e) {\n        this.parent.isBlur = false;\n        this.contentRenderer.getEditPanel().focus();\n        if (isNullOrUndefined(e.items) || e.items) {\n            this.saveSelection.restore();\n        }\n    };\n    HtmlEditor.prototype.onKeyUp = function (e) {\n        var args = e.args;\n        var restrictKeys = [8, 9, 13, 16, 17, 18, 20, 27, 37, 38, 39, 40, 44, 45, 46, 91,\n            112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123];\n        var range = this.parent.getRange();\n        var regEx = new RegExp(String.fromCharCode(8203), 'g');\n        var pointer;\n        if (restrictKeys.indexOf(args.keyCode) < 0 && !args.shiftKey && !args.ctrlKey && !args.altKey) {\n            if (range.startContainer.textContent.charCodeAt(0) === 8203) {\n                pointer = range.startOffset - 1;\n                range.startContainer.textContent = range.startContainer.textContent.replace(regEx, '');\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n            }\n            if (!isNOU(range.startContainer.previousSibling) && !isNOU(range.startContainer.previousSibling.parentElement) &&\n                range.startContainer.parentElement === range.startContainer.previousSibling.parentElement && range.startContainer.previousSibling.textContent.charCodeAt(0) === 8203) {\n                range.startContainer.previousSibling.textContent = range.startContainer.previousSibling.textContent.replace(regEx, '');\n            }\n            if (range.endContainer.textContent.charCodeAt(range.endOffset) === 8203) {\n                pointer = range.startOffset;\n                range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n            }\n        }\n    };\n    HtmlEditor.prototype.onKeyDown = function (e) {\n        var _this = this;\n        var currentRange;\n        var args = e.args;\n        if (Browser.info.name === 'chrome') {\n            currentRange = this.parent.getRange();\n            this.backSpaceCleanup(e, currentRange);\n            this.deleteCleanup(e, currentRange);\n        }\n        if (args.keyCode === 9 && this.parent.enableTabKey) {\n            if (!isNOU(args.target) && isNullOrUndefined(closest(args.target, '.e-rte-toolbar'))) {\n                var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n                var parentNode = this.nodeSelectionObj.getParentNodeCollection(range);\n                if (!((parentNode[0].nodeName === 'LI' || closest(parentNode[0], 'li') ||\n                    closest(parentNode[0], 'table')) && range.startOffset === 0)) {\n                    args.preventDefault();\n                    if (!args.shiftKey) {\n                        InsertHtml.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;');\n                        this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));\n                    }\n                    else if (this.rangeCollection.length > 0 &&\n                        this.rangeCollection[this.rangeCollection.length - 1].startContainer.textContent.length === 4) {\n                        var textCont = this.rangeCollection[this.rangeCollection.length - 1].startContainer;\n                        this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(), textCont, textCont, 0, textCont.textContent.length);\n                        InsertHtml.Insert(this.contentRenderer.getDocument(), document.createTextNode(''));\n                        this.rangeCollection.pop();\n                    }\n                }\n            }\n        }\n        if (e.args.action === 'space' ||\n            e.args.action === 'enter' ||\n            e.args.keyCode === 13) {\n            this.spaceLink(e.args);\n            if (this.parent.editorMode === 'HTML' && !((this.parent.shiftEnterKey === 'BR' && e.args.shiftKey))) {\n                this.parent.notify(events.enterHandler, { args: e.args });\n            }\n        }\n        if (e.args.action === 'space') {\n            var currentRange_1 = this.parent.getRange();\n            var editorValue = currentRange_1.startContainer.textContent.slice(0, currentRange_1.startOffset);\n            var orderedList_1 = this.isOrderedList(editorValue);\n            var unOrderedList = this.isUnOrderedList(editorValue);\n            if (orderedList_1 && !unOrderedList || unOrderedList && !orderedList_1) {\n                var eventArgs_1 = {\n                    callBack: null,\n                    event: e.args,\n                    name: 'keydown-handler'\n                };\n                var actionBeginArgs = {\n                    cancel: false,\n                    item: { command: 'Lists', subCommand: orderedList_1 ? 'OL' : 'UL' },\n                    name: 'actionBegin',\n                    originalEvent: e.args,\n                    requestType: orderedList_1 ? 'OL' : 'UL'\n                };\n                this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n                    if (!actionBeginArgs.cancel) {\n                        _this.parent.formatter.editorManager.observer.notify(ON_BEGIN, eventArgs_1);\n                        _this.parent.trigger(events.actionComplete, {\n                            editorMode: _this.parent.editorMode,\n                            elements: _this.parent.formatter.editorManager.domNode.blockNodes(),\n                            event: e.args,\n                            name: events.actionComplete,\n                            range: _this.parent.getRange(),\n                            requestType: orderedList_1 ? 'OL' : 'UL'\n                        });\n                    }\n                });\n            }\n        }\n        if (Browser.info.name === 'chrome' && (!isNullOrUndefined(this.rangeElement) && !isNullOrUndefined(this.oldRangeElement) ||\n            !isNullOrUndefined(this.deleteRangeElement) && !isNullOrUndefined(this.deleteOldRangeElement)) &&\n            currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.rangeElement = null;\n            this.oldRangeElement = null;\n            this.deleteRangeElement = null;\n            this.deleteOldRangeElement = null;\n            args.preventDefault();\n        }\n    };\n    HtmlEditor.prototype.isOrderedList = function (editorValue) {\n        editorValue = editorValue.replace(/\\u200B/g, '');\n        var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n        if (!isNullOrUndefined(editorValue)) {\n            for (var i = 0; i < olListStartRegex.length; i++) {\n                if (olListStartRegex[i].test(editorValue)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    HtmlEditor.prototype.isUnOrderedList = function (editorValue) {\n        editorValue = editorValue.replace(/\\u200B/g, '');\n        var ulListStartRegex = [/^[*]$/, /^[-]$/];\n        if (!isNullOrUndefined(editorValue)) {\n            for (var i = 0; i < ulListStartRegex.length; i++) {\n                if (ulListStartRegex[i].test(editorValue)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    HtmlEditor.prototype.backSpaceCleanup = function (e, currentRange) {\n        var isLiElement = false;\n        if (e.args.code === 'Backspace' && e.args.keyCode === 8 && currentRange.startOffset === 0 &&\n            currentRange.endOffset === 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.textContent.length > 0 &&\n            currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.rangeElement = this.getRootBlockNode(currentRange.startContainer);\n            if (this.rangeElement.tagName === 'OL' || this.rangeElement.tagName === 'UL') {\n                var liElement = this.getRangeLiNode(currentRange.startContainer);\n                if (liElement.previousElementSibling && liElement.previousElementSibling.childElementCount > 0) {\n                    this.oldRangeElement = liElement.previousElementSibling.lastElementChild;\n                    if (!isNullOrUndefined(liElement.lastElementChild)) {\n                        this.rangeElement = liElement.lastElementChild;\n                        isLiElement = true;\n                    }\n                    else {\n                        this.rangeElement = liElement;\n                    }\n                }\n            }\n            else if (this.rangeElement.tagName === 'TABLE' || (!isNullOrUndefined(this.rangeElement.previousElementSibling) &&\n                this.rangeElement.previousElementSibling.tagName === 'TABLE')) {\n                return;\n            }\n            else {\n                this.oldRangeElement = this.rangeElement.previousElementSibling;\n            }\n            if (isNullOrUndefined(this.oldRangeElement)) {\n                return;\n            }\n            else {\n                if (this.oldRangeElement.tagName === 'OL' || this.oldRangeElement.tagName === 'UL') {\n                    this.oldRangeElement = this.oldRangeElement.lastElementChild.lastElementChild\n                        ? this.oldRangeElement.lastElementChild.lastElementChild :\n                        this.oldRangeElement.lastElementChild;\n                }\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), \n                // eslint-disable-next-line\n                this.oldRangeElement, this.oldRangeElement.childNodes.length);\n                if (this.oldRangeElement.querySelector('BR')) {\n                    detach(this.oldRangeElement.querySelector('BR'));\n                }\n                if (!isNullOrUndefined(this.rangeElement) && this.oldRangeElement !== this.rangeElement) {\n                    while (this.rangeElement.firstChild) {\n                        this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);\n                    }\n                    // eslint-disable-next-line\n                    !isLiElement ? detach(this.rangeElement) : detach(this.rangeElement.parentElement);\n                    this.oldRangeElement.normalize();\n                }\n            }\n        }\n    };\n    HtmlEditor.prototype.deleteCleanup = function (e, currentRange) {\n        var isLiElement = false;\n        var liElement;\n        var rootElement;\n        if (e.args.code === 'Delete' && e.args.keyCode === 46 &&\n            this.parent.contentModule.getText().trim().length !== 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.parentElement.tagName !== 'TD' &&\n            currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.deleteRangeElement = rootElement = this.getRootBlockNode(currentRange.startContainer);\n            if (this.deleteRangeElement.tagName === 'OL' || this.deleteRangeElement.tagName === 'UL') {\n                liElement = this.getRangeLiNode(currentRange.startContainer);\n                if (liElement.nextElementSibling && liElement.nextElementSibling.childElementCount > 0\n                    && !liElement.nextElementSibling.querySelector('BR')) {\n                    if (!isNullOrUndefined(liElement.lastElementChild)) {\n                        this.deleteRangeElement = liElement.lastElementChild;\n                        isLiElement = true;\n                    }\n                    else {\n                        this.deleteRangeElement = liElement;\n                    }\n                }\n                else {\n                    this.deleteRangeElement = this.getRangeElement(liElement);\n                }\n            }\n            else if (this.deleteRangeElement.nodeType === 3 || (this.deleteRangeElement.tagName === 'TABLE' ||\n                (!isNullOrUndefined(this.deleteRangeElement.nextElementSibling) && this.deleteRangeElement.nextElementSibling.tagName === 'TABLE'))) {\n                return;\n            }\n            if (this.getCaretIndex(currentRange, this.deleteRangeElement) === this.deleteRangeElement.textContent.length) {\n                if (!isNullOrUndefined(liElement)) {\n                    if (isLiElement || !isNullOrUndefined(liElement.nextElementSibling)) {\n                        this.deleteOldRangeElement = this.getRangeElement(liElement.nextElementSibling);\n                    }\n                    else {\n                        this.deleteOldRangeElement = rootElement.nextElementSibling;\n                    }\n                }\n                else {\n                    this.deleteOldRangeElement = this.deleteRangeElement.nextElementSibling;\n                }\n                if (isNullOrUndefined(this.deleteOldRangeElement)) {\n                    return;\n                }\n                else {\n                    this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement.childNodes.length);\n                    if (this.deleteRangeElement.querySelector('BR')) {\n                        detach(this.deleteRangeElement.querySelector('BR'));\n                    }\n                    if (!isNullOrUndefined(this.deleteRangeElement) && (this.deleteOldRangeElement.tagName !== 'OL' && this.deleteOldRangeElement.tagName !== 'UL')\n                        && this.deleteOldRangeElement !== this.deleteRangeElement) {\n                        while (this.deleteOldRangeElement.firstChild) {\n                            this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);\n                        }\n                        if (!isLiElement) {\n                            detach(this.deleteOldRangeElement);\n                        }\n                        else {\n                            detach(this.deleteOldRangeElement.parentElement);\n                        }\n                        this.deleteRangeElement.normalize();\n                    }\n                    else {\n                        this.deleteRangeElement = null;\n                        this.deleteOldRangeElement = null;\n                    }\n                }\n            }\n            else {\n                this.deleteRangeElement = null;\n            }\n        }\n    };\n    HtmlEditor.prototype.getCaretIndex = function (currentRange, element) {\n        var position = 0;\n        if (this.parent.contentModule.getDocument().getSelection().rangeCount !== 0) {\n            var preCaretRange = currentRange.cloneRange();\n            preCaretRange.selectNodeContents(element);\n            preCaretRange.setEnd(currentRange.endContainer, currentRange.endOffset);\n            position = preCaretRange.toString().length;\n        }\n        return position;\n    };\n    HtmlEditor.prototype.getRangeElement = function (element) {\n        var rangeElement = element.lastElementChild ? element.lastElementChild.tagName === 'BR' ?\n            element.lastElementChild.previousElementSibling ? element.lastElementChild.previousElementSibling\n                : element : element.lastElementChild : element;\n        return rangeElement;\n    };\n    HtmlEditor.prototype.getRootBlockNode = function (rangeBlockNode) {\n        // eslint-disable-next-line\n        for (; rangeBlockNode && this.parent && this.parent.inputElement !== rangeBlockNode; rangeBlockNode = rangeBlockNode) {\n            if (rangeBlockNode.parentElement === this.parent.inputElement) {\n                break;\n            }\n            else {\n                rangeBlockNode = rangeBlockNode.parentElement;\n            }\n        }\n        return rangeBlockNode;\n    };\n    HtmlEditor.prototype.getRangeLiNode = function (rangeLiNode) {\n        var node = rangeLiNode.parentElement;\n        while (node !== this.parent.inputElement) {\n            if (node.nodeType === 1 && node.tagName === 'LI') {\n                break;\n            }\n            node = node.parentElement;\n        }\n        return node;\n    };\n    HtmlEditor.prototype.onPaste = function (e) {\n        // eslint-disable-next-line\n        var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n        if (e.text.match(regex)) {\n            if (e.isWordPaste) {\n                return;\n            }\n            e.args.preventDefault();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            // eslint-disable-next-line\n            var saveSelection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            // eslint-disable-next-line\n            var httpRegex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)))/gi);\n            var wwwRegex = new RegExp(/([^\\S]|^)(((www\\.))(\\S+))/gi);\n            var enterSplitText = e.text.split('\\n');\n            var contentInnerElem = '';\n            for (var i = 0; i < enterSplitText.length; i++) {\n                if (enterSplitText[i].trim() === '') {\n                    contentInnerElem += getDefaultValue(this.parent);\n                }\n                else {\n                    var contentWithSpace = '';\n                    var spaceBetweenContent = true;\n                    var spaceSplit = enterSplitText[i].split(' ');\n                    for (var j = 0; j < spaceSplit.length; j++) {\n                        if (spaceSplit[j].trim() === '') {\n                            contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n                        }\n                        else {\n                            spaceBetweenContent = false;\n                            contentWithSpace += spaceSplit[j] + ' ';\n                        }\n                    }\n                    if (i === 0) {\n                        contentInnerElem += '<span>' + contentWithSpace.trim() + '</span>';\n                    }\n                    else {\n                        contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n                    }\n                }\n            }\n            var divElement = this.parent.createElement('div');\n            divElement.setAttribute('class', 'pasteContent');\n            divElement.style.display = 'inline';\n            divElement.innerHTML = contentInnerElem;\n            var paraElem = divElement.querySelectorAll('span, p');\n            for (var i = 0; i < paraElem.length; i++) {\n                var splitTextContent = paraElem[i].innerHTML.split(' ');\n                var resultSplitContent = '';\n                for (var j = 0; j < splitTextContent.length; j++) {\n                    if (splitTextContent[j].match(httpRegex) || splitTextContent[j].match(wwwRegex)) {\n                        resultSplitContent += '<a className=\"e-rte-anchor\" href=\"' + splitTextContent[j] +\n                            '\" title=\"' + splitTextContent[j] + '\"target=\"_blank\">' + splitTextContent[j] + ' </a>';\n                    }\n                    else {\n                        resultSplitContent += splitTextContent[j] + ' ';\n                    }\n                }\n                paraElem[i].innerHTML = resultSplitContent.trim();\n            }\n            if (!isNullOrUndefined(this.parent.pasteCleanupModule)) {\n                e.callBack(divElement.innerHTML);\n            }\n            else {\n                this.parent.formatter.editorManager.execCommand('insertHTML', null, null, null, divElement);\n            }\n        }\n    };\n    HtmlEditor.prototype.spaceLink = function (e) {\n        var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n        var selectNodeEle = this.nodeSelectionObj.getParentNodeCollection(range);\n        var text = range.startContainer.textContent.substr(0, range.endOffset);\n        var splitText = text.split(' ');\n        var urlText = splitText[splitText.length - 1];\n        var urlTextRange = range.startOffset - (text.length - splitText[splitText.length - 1].length);\n        urlText = urlText.slice(0, urlTextRange);\n        // eslint-disable-next-line\n        var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n        if (selectNodeEle[0].nodeName !== 'A' && urlText.match(regex)) {\n            var selection = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n            var url = urlText.indexOf('http') > -1 ? urlText : 'http://' + urlText;\n            var selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            var value = {\n                url: url,\n                selection: selection, selectParent: selectParent,\n                text: urlText,\n                title: '',\n                target: '_blank'\n            };\n            this.parent.formatter.process(this.parent, {\n                item: {\n                    'command': 'Links',\n                    'subCommand': 'CreateLink'\n                }\n            }, e, value);\n        }\n    };\n    HtmlEditor.prototype.onToolbarClick = function (args) {\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        var item = args.item;\n        var closestElement = closest(args.originalEvent.target, '.e-rte-quick-popup');\n        if (closestElement && !closestElement.classList.contains('e-rte-inline-popup')) {\n            if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' ||\n                item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n                if (isIDevice() && item.command === 'Images') {\n                    this.nodeSelectionObj.restore();\n                }\n                var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n                save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n                selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n                selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n            }\n            if (item.command === 'Images') {\n                this.parent.notify(events.imageToolbarAction, {\n                    member: 'image', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                });\n            }\n            if (item.command === 'Links') {\n                this.parent.notify(events.linkToolbarAction, {\n                    member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                });\n            }\n            if (item.command === 'Table') {\n                this.parent.notify(events.tableToolbarAction, {\n                    member: 'table', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                });\n            }\n        }\n        else {\n            var linkDialog = document.getElementById(this.parent.getID() + '_rtelink');\n            var imageDialog = document.getElementById(this.parent.getID() + '_image');\n            if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' ||\n                item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n                var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n                if (isNullOrUndefined(linkDialog) && isNullOrUndefined(imageDialog)) {\n                    save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n                }\n                selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n                selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n            }\n            switch (item.subCommand) {\n                case 'Maximize':\n                    this.parent.notify(events.enableFullScreen, { args: args });\n                    break;\n                case 'Minimize':\n                    this.parent.notify(events.disableFullScreen, { args: args });\n                    break;\n                case 'CreateLink':\n                    this.parent.notify(events.insertLink, {\n                        member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                case 'RemoveLink':\n                    this.parent.notify(events.unLink, {\n                        member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                case 'Print':\n                    this.parent.print();\n                    break;\n                case 'Image':\n                    this.parent.notify(events.insertImage, {\n                        member: 'image', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                case 'CreateTable':\n                    this.parent.notify(events.createTable, {\n                        member: 'table', args: args, selection: save\n                    });\n                    break;\n                case 'SourceCode':\n                    this.parent.notify(events.sourceCode, { member: 'viewSource', args: args });\n                    break;\n                case 'Preview':\n                    this.parent.notify(events.updateSource, { member: 'updateSource', args: args });\n                    break;\n                case 'FontColor':\n                case 'BackgroundColor':\n                    break;\n                case 'File':\n                    this.parent.notify(events.renderFileManager, {\n                        member: 'fileManager', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                default:\n                    this.parent.formatter.process(this.parent, args, args.originalEvent, null);\n                    break;\n            }\n        }\n    };\n    HtmlEditor.prototype.renderColorPicker = function (args) {\n        this.colorPickerModule.renderColorPickerInput(args);\n    };\n    HtmlEditor.prototype.instantiateRenderer = function () {\n        if (this.parent.iframeSettings.enable) {\n            this.renderFactory.addRenderer(RenderType.Content, new IframeContentRender(this.parent, this.locator));\n        }\n        else {\n            this.renderFactory.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n        }\n    };\n    HtmlEditor.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.initialEnd, this.render);\n        this.parent.off(events.modelChanged, this.onPropertyChanged);\n        this.parent.off(events.htmlToolbarClick, this.onToolbarClick);\n        this.parent.off(events.renderColorPicker, this.renderColorPicker);\n        this.parent.off(events.destroy, this.destroy);\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.initialLoad, this.instantiateRenderer);\n        this.parent.off(events.selectAll, this.selectAll);\n        this.parent.off(events.selectRange, this.selectRange);\n        this.parent.off(events.getSelectedHtml, this.getSelectedHtml);\n        this.parent.off(events.selectionSave, this.onSelectionSave);\n        this.parent.off(events.selectionRestore, this.onSelectionRestore);\n        this.parent.off(events.readOnlyMode, this.updateReadOnly);\n        this.parent.off(events.paste, this.onPaste);\n    };\n    HtmlEditor.prototype.render = function () {\n        this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n        var editElement = this.contentRenderer.getEditPanel();\n        var option = { undoRedoSteps: this.parent.undoRedoSteps, undoRedoTimer: this.parent.undoRedoTimer };\n        if (isNullOrUndefined(this.parent.formatter)) {\n            var formatterClass = new HTMLFormatter({\n                currentDocument: this.contentRenderer.getDocument(),\n                element: editElement,\n                options: option\n            });\n            this.parent.setProperties({ formatter: formatterClass }, true);\n        }\n        else {\n            this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n        }\n        if (this.parent.enableXhtml) {\n            this.parent.notify(events.xhtmlValidation, {});\n        }\n        if (this.parent.toolbarSettings.enable) {\n            this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n        }\n        if (this.parent.inlineMode.enable) {\n            if (!isNullOrUndefined(this.parent.fontFamily.default)) {\n                editElement.style.fontFamily = this.parent.fontFamily.default;\n            }\n            if (!isNullOrUndefined(this.parent.fontSize.default)) {\n                editElement.style.fontSize = this.parent.fontSize.default;\n            }\n        }\n        this.parent.notify(events.bindOnEnd, {});\n    };\n    /**\n     * Called internally if any of the property value changed.\n     *\n     * @param {RichTextEditorModel} e - specifies the editor model\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.onPropertyChanged = function (e) {\n        // On property code change here\n        if (!isNullOrUndefined(e.newProp.formatter)) {\n            var editElement = this.contentRenderer.getEditPanel();\n            var option = { undoRedoSteps: this.parent.undoRedoSteps,\n                undoRedoTimer: this.parent.undoRedoTimer };\n            this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n        }\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {string} - returns the string value\n     * @hidden\n     */\n    HtmlEditor.prototype.getModuleName = function () {\n        return 'htmlEditor';\n    };\n    /**\n     * For selecting all content in RTE\n     *\n     * @returns {void}\n     * @private\n     * @hidden\n     */\n    HtmlEditor.prototype.selectAll = function () {\n        var nodes = getTextNodesUnder(this.parent.contentModule.getDocument(), this.parent.contentModule.getEditPanel());\n        if (nodes.length > 0) {\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), nodes[0], nodes[nodes.length - 1], 0, nodes[nodes.length - 1].textContent.length);\n        }\n    };\n    /**\n     * For selecting all content in RTE\n     *\n     * @param {NotifyArgs} e - specifies the notified arguments\n     * @returns {void}\n     * @private\n     * @hidden\n     */\n    HtmlEditor.prototype.selectRange = function (e) {\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(), e.range);\n    };\n    /**\n     * For get a selected text in RTE\n     *\n     * @param {NotifyArgs} e - specifies the notified arguments\n     * @returns {void}\n     * @hidden\n     */\n    HtmlEditor.prototype.getSelectedHtml = function (e) {\n        e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString());\n    };\n    return HtmlEditor;\n}());\nexport { HtmlEditor };\n"]},"metadata":{},"sourceType":"module"}