{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { PdfGanttTaskbarCollection } from './pdf-taskbar';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { PointF, PdfPen, PdfColor } from '@syncfusion/ej2-pdf-export';\nimport { PdfTreeGrid } from './pdf-treegrid';\nimport { PdfTimeline } from './pdf-timeline';\nimport { pixelToPoint, pointToPixel } from '../base/utils';\nimport { PdfGanttPredecessor } from './pdf-connector-line';\n/**\n *\n */\n\nvar PdfGantt =\n/** @class */\nfunction (_super) {\n  __extends(PdfGantt, _super);\n\n  function PdfGantt(parent) {\n    var _this = _super.call(this) || this;\n\n    _this.exportProps = {};\n    _this.parent = parent;\n    _this.chartHeader = new PdfTimeline(_this);\n    _this.predecessor = new PdfGanttPredecessor(parent, _this);\n    _this.headerDetails = [];\n    _this.pdfPageDetail = [];\n    _this.taskbarCollection = [];\n    _this.predecessorCollection = [];\n    return _this;\n  }\n\n  Object.defineProperty(PdfGantt.prototype, \"taskbar\", {\n    get: function () {\n      if (isNullOrUndefined(this.taskbars)) {\n        this.taskbars = new PdfGanttTaskbarCollection(this.parent);\n      }\n\n      return this.taskbars;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  PdfGantt.prototype.drawChart = function (result) {\n    this.result = result;\n    this.totalPages = this.result.page.section.count;\n    this.perColumnPages = this.totalPages / this.layouter.columnRanges.length;\n    this.calculateRange();\n    this.drawGantttChart();\n    this.drawPageBorder();\n  }; //Calcualte the header range for each pdf page based on schedule start and end date.\n\n\n  PdfGantt.prototype.calculateRange = function () {\n    var lastColumnRange = this.layouter.columnRanges[this.layouter.columnRanges.length - 1];\n    var totalColumnWidth = 0;\n    var isPageFinished = true;\n    var pageWidth = 0;\n    var remainWidth = 0;\n    var point = 0;\n    var headerWidth = pixelToPoint(this.chartHeader.width);\n    var timelineSettings = this.parent.timelineModule;\n\n    for (var index = lastColumnRange[0]; index <= lastColumnRange[1]; index++) {\n      totalColumnWidth += this.layouter.treegrid.columns.getColumn(index).width;\n    }\n\n    totalColumnWidth += 0.5;\n\n    if (totalColumnWidth + 100 < this.result.page.getClientSize().width) {\n      remainWidth = this.result.page.getClientSize().width - totalColumnWidth;\n      this.chartPageIndex = this.startPageIndex = this.totalPages - this.perColumnPages;\n      isPageFinished = false;\n      this.startPoint = new PointF(totalColumnWidth, 0);\n    } else {\n      this.result.page.section.add();\n      this.chartPageIndex = this.startPageIndex = this.totalPages;\n      isPageFinished = true;\n      this.startPoint = new PointF(point, 0);\n    }\n\n    while (Math.round(point) < Math.round(headerWidth)) {\n      if (isPageFinished) {\n        pageWidth = this.result.page.getClientSize().width;\n      } else {\n        pageWidth = remainWidth;\n        isPageFinished = true;\n      }\n\n      var detail = {};\n      var range = [];\n      var convertedWidth = pixelToPoint(this.chartHeader.bottomTierCellWidth);\n      var width = 0;\n\n      if (this.chartHeader.bottomTierCellWidth !== 0) {\n        width = Math.floor(pageWidth / convertedWidth) * convertedWidth;\n      }\n\n      range[0] = point;\n\n      if (headerWidth - point <= width) {\n        range[1] = headerWidth;\n        detail.totalWidth = pointToPixel(headerWidth - point);\n      } else {\n        range[1] = point + width;\n        detail.totalWidth = pointToPixel(width);\n      }\n\n      detail.startPoint = range[0];\n      detail.endPoint = range[1];\n\n      if (this.parent.cloneProjectStartDate.getHours() === 0 && this.parent.cloneProjectStartDate.getMinutes() === 0 && this.parent.cloneProjectStartDate.getSeconds() === 0) {\n        this.parent.cloneProjectStartDate.setHours(8);\n      }\n\n      var timelineStartDate = this.parent.dataOperation.getDateFromFormat(this.parent.cloneProjectStartDate);\n      var count = isNullOrUndefined(timelineSettings.customTimelineSettings.bottomTier.count) ? timelineSettings.customTimelineSettings.topTier.count : timelineSettings.customTimelineSettings.bottomTier.count;\n      var scheduleType = timelineSettings.customTimelineSettings.bottomTier.unit === 'None' ? timelineSettings.customTimelineSettings.topTier.unit : timelineSettings.customTimelineSettings.bottomTier.unit;\n\n      switch (scheduleType) {\n        case 'Minutes':\n          {\n            detail.startDate = new Date(timelineStartDate.getTime());\n            var sDays = Math.floor(pointToPixel(detail.startPoint) / this.chartHeader.bottomTierCellWidth);\n            detail.startDate.setMinutes(detail.startDate.getMinutes() + sDays * count);\n            detail.startDate.setSeconds(detail.startDate.getSeconds() + 1);\n            detail.endDate = new Date(detail.startDate.getTime());\n            var eDays = Math.floor(pointToPixel(detail.endPoint - detail.startPoint) / this.chartHeader.bottomTierCellWidth);\n            detail.endDate.setMinutes(detail.endDate.getMinutes() + eDays * count);\n            break;\n          }\n\n        case 'Hour':\n          {\n            detail.startDate = new Date(timelineStartDate.getTime());\n            var sDays1 = Math.floor(pointToPixel(detail.startPoint) / this.chartHeader.bottomTierCellWidth);\n            detail.startDate.setHours(detail.startDate.getHours() + sDays1 * count);\n            detail.startDate.setMinutes(detail.startDate.getMinutes() + 1);\n            detail.endDate = new Date(detail.startDate.getTime());\n            var eDays1 = Math.floor(pointToPixel(detail.endPoint - detail.startPoint) / this.chartHeader.bottomTierCellWidth);\n            detail.endDate.setHours(detail.endDate.getHours() + eDays1 * count);\n            break;\n          }\n\n        case 'Day':\n          {\n            detail.startDate = new Date(timelineStartDate.getTime());\n            var startDays = Math.round(detail.startPoint / pixelToPoint(this.chartHeader.bottomTierCellWidth));\n            detail.startDate.setDate(detail.startDate.getDate() + startDays * count);\n            var endDays = Math.round((detail.endPoint - detail.startPoint) / pixelToPoint(this.chartHeader.bottomTierCellWidth)) - 1;\n            detail.endDate = new Date(detail.startDate.getTime());\n            detail.endDate.setDate(detail.startDate.getDate() + endDays * count);\n            break;\n          }\n\n        case 'Week':\n          {\n            detail.startDate = new Date(timelineStartDate.getTime());\n            var startDays1 = detail.startPoint / pixelToPoint(this.chartHeader.bottomTierCellWidth) * 7;\n            detail.startDate.setDate(detail.startDate.getDate() + startDays1 * count);\n            var endDays1 = Math.round((detail.endPoint - detail.startPoint) / pixelToPoint(this.chartHeader.bottomTierCellWidth)) * 7 - 1;\n            detail.endDate = new Date(detail.startDate.getTime());\n            detail.endDate.setDate(detail.startDate.getDate() + endDays1 * count);\n            break;\n          }\n\n        case 'Month':\n          {\n            detail.startDate = new Date(timelineStartDate.getTime());\n            var startDays2 = detail.startPoint / pixelToPoint(this.chartHeader.bottomTierCellWidth) * 31;\n            detail.startDate.setDate(detail.startDate.getDate() + startDays2 * count);\n            var endDays2 = Math.round((detail.endPoint - detail.startPoint) / pixelToPoint(this.chartHeader.bottomTierCellWidth)) * 31 - 1;\n            detail.endDate = new Date(detail.startDate.getTime());\n            detail.endDate.setDate(detail.startDate.getDate() + endDays2 * count);\n            break;\n          }\n\n        case 'Year':\n          {\n            detail.startDate = new Date(timelineStartDate.getTime());\n            var startDays3 = detail.startPoint / pixelToPoint(this.chartHeader.bottomTierCellWidth) * 365;\n            detail.startDate.setDate(detail.startDate.getDate() + startDays3 * count);\n            var endDays3 = Math.round((detail.endPoint - detail.startPoint) / pixelToPoint(this.chartHeader.bottomTierCellWidth)) * 365 - 1;\n            detail.endDate = new Date(detail.startDate.getTime());\n            detail.endDate.setDate(detail.startDate.getDate() + endDays3 * count);\n            break;\n          }\n      }\n\n      this.headerDetails.push(detail);\n      point += width;\n    }\n  };\n\n  PdfGantt.prototype.drawPageBorder = function () {\n    var pages = this.result.page.section.getPages();\n\n    for (var index = 0; index < pages.length; index++) {\n      var page = pages[index];\n      var graphics = page.graphics;\n      var pageSize = page.getClientSize();\n      var pen = new PdfPen(new PdfColor(206, 206, 206));\n      graphics.drawRectangle(pen, 0, 0, pageSize.width, pageSize.height);\n    }\n  }; //Draw the gantt chart side\n\n\n  PdfGantt.prototype.drawGantttChart = function () {\n    var _this = this;\n\n    var taskbarPoint = this.startPoint;\n    var pagePoint = new PointF();\n    var pageStartX = 0;\n    var cumulativeWidth = 0;\n    var cumulativeHeight = 0;\n    var totalHeight = 0;\n    var pageData;\n    this.headerDetails.forEach(function (detail, index) {\n      var page = _this.result.page.section.getPages()[_this.startPageIndex];\n\n      _this.chartHeader.drawTimeline(page, _this.startPoint, detail);\n\n      taskbarPoint.y = taskbarPoint.y + pixelToPoint(_this.parent.timelineModule.isSingleTier ? 45 : 60); // headerHeight\n\n      pageStartX = taskbarPoint.x;\n      cumulativeHeight = pixelToPoint(_this.parent.timelineModule.isSingleTier ? 45 : 60); // headerHeight\n\n      _this.headerDetails[_this.headerDetails.indexOf(detail)].startIndex = _this.startPageIndex;\n      _this.headerDetails[_this.headerDetails.indexOf(detail)].pageStartPoint = taskbarPoint;\n\n      for (var i = 0; i < _this.taskbarCollection.length; i++) {\n        var task = _this.taskbarCollection[i];\n\n        var rowHeight = _this.rows.getRow(i + 1).height;\n\n        var pdfPage = _this.result.page.section.getPages()[_this.startPageIndex];\n        /* eslint-disable-next-line */\n\n\n        var isNextPage = task.drawTaskbar(pdfPage, taskbarPoint, detail, cumulativeWidth, rowHeight, _this.taskbarCollection[i]);\n\n        if (isNextPage) {\n          if (_this.enableHeader) {\n            taskbarPoint.y = pixelToPoint(_this.parent.timelineModule.isSingleTier ? 45 : 60);\n          } else {\n            taskbarPoint.y = 0;\n          }\n\n          _this.startPageIndex++;\n          pageData = {};\n          pageData.height = cumulativeHeight;\n          pageData.pageStartX = pageStartX;\n          pageData.startPoint = __assign({}, pagePoint);\n          pageData.width = pixelToPoint(detail.totalWidth);\n\n          _this.pdfPageDetail.push(pageData);\n\n          pagePoint.y += pageData.height;\n\n          if (_this.enableHeader) {\n            cumulativeHeight = _this.chartHeader.height;\n          } else {\n            taskbarPoint.y = 0;\n            cumulativeHeight = 0;\n          }\n        }\n\n        taskbarPoint.y += rowHeight;\n        cumulativeHeight += rowHeight; // eslint-disable-next-line\n\n        totalHeight += rowHeight;\n      }\n\n      _this.headerDetails[index].endIndex = _this.startPageIndex;\n      cumulativeWidth += detail.totalWidth;\n      pageData = {};\n      pageData.height = cumulativeHeight;\n      pageData.pageStartX = pageStartX;\n      pageData.startPoint = __assign({}, pagePoint);\n      pageData.width = pixelToPoint(detail.totalWidth);\n\n      _this.pdfPageDetail.push(pageData);\n\n      pagePoint.x += pageData.width;\n      pagePoint.y = 0;\n\n      if (_this.enableHeader) {\n        cumulativeHeight = _this.chartHeader.height;\n      } else {\n        taskbarPoint.y = 0;\n      }\n\n      if (_this.headerDetails.indexOf(detail) !== _this.headerDetails.length - 1) {\n        _this.result.page.section.add();\n\n        _this.startPageIndex = _this.result.page.section.count - 1;\n        taskbarPoint = _this.startPoint = new PointF(0, 0);\n      }\n    }); // Draw predecessor line.\n\n    for (var i = 0; i < this.predecessorCollection.length; i++) {\n      var predecessor = this.predecessorCollection[i];\n      predecessor.drawPredecessor(this);\n    }\n  };\n\n  return PdfGantt;\n}(PdfTreeGrid);\n\nexport { PdfGantt };","map":{"version":3,"sources":["/Users/tristanbilot/Desktop/Design4green/design4green/node_modules/@syncfusion/ej2-gantt/src/gantt/export/pdf-gantt.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","PdfGanttTaskbarCollection","isNullOrUndefined","PointF","PdfPen","PdfColor","PdfTreeGrid","PdfTimeline","pixelToPoint","pointToPixel","PdfGanttPredecessor","PdfGantt","_super","parent","_this","exportProps","chartHeader","predecessor","headerDetails","pdfPageDetail","taskbarCollection","predecessorCollection","defineProperty","get","taskbars","enumerable","configurable","drawChart","result","totalPages","page","section","count","perColumnPages","layouter","columnRanges","calculateRange","drawGantttChart","drawPageBorder","lastColumnRange","totalColumnWidth","isPageFinished","pageWidth","remainWidth","point","headerWidth","width","timelineSettings","timelineModule","index","treegrid","columns","getColumn","getClientSize","chartPageIndex","startPageIndex","startPoint","add","Math","round","detail","range","convertedWidth","bottomTierCellWidth","floor","totalWidth","endPoint","cloneProjectStartDate","getHours","getMinutes","getSeconds","setHours","timelineStartDate","dataOperation","getDateFromFormat","customTimelineSettings","bottomTier","topTier","scheduleType","unit","startDate","Date","getTime","sDays","setMinutes","setSeconds","endDate","eDays","sDays1","eDays1","startDays","setDate","getDate","endDays","startDays1","endDays1","startDays2","endDays2","startDays3","endDays3","push","pages","getPages","graphics","pageSize","pen","drawRectangle","height","taskbarPoint","pagePoint","pageStartX","cumulativeWidth","cumulativeHeight","totalHeight","pageData","forEach","drawTimeline","y","isSingleTier","x","indexOf","startIndex","pageStartPoint","task","rowHeight","rows","getRow","pdfPage","isNextPage","drawTaskbar","enableHeader","endIndex","drawPredecessor"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { PdfGanttTaskbarCollection } from './pdf-taskbar';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { PointF, PdfPen, PdfColor } from '@syncfusion/ej2-pdf-export';\nimport { PdfTreeGrid } from './pdf-treegrid';\nimport { PdfTimeline } from './pdf-timeline';\nimport { pixelToPoint, pointToPixel } from '../base/utils';\nimport { PdfGanttPredecessor } from './pdf-connector-line';\n/**\n *\n */\nvar PdfGantt = /** @class */ (function (_super) {\n    __extends(PdfGantt, _super);\n    function PdfGantt(parent) {\n        var _this = _super.call(this) || this;\n        _this.exportProps = {};\n        _this.parent = parent;\n        _this.chartHeader = new PdfTimeline(_this);\n        _this.predecessor = new PdfGanttPredecessor(parent, _this);\n        _this.headerDetails = [];\n        _this.pdfPageDetail = [];\n        _this.taskbarCollection = [];\n        _this.predecessorCollection = [];\n        return _this;\n    }\n    Object.defineProperty(PdfGantt.prototype, \"taskbar\", {\n        get: function () {\n            if (isNullOrUndefined(this.taskbars)) {\n                this.taskbars = new PdfGanttTaskbarCollection(this.parent);\n            }\n            return this.taskbars;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    PdfGantt.prototype.drawChart = function (result) {\n        this.result = result;\n        this.totalPages = this.result.page.section.count;\n        this.perColumnPages = this.totalPages / this.layouter.columnRanges.length;\n        this.calculateRange();\n        this.drawGantttChart();\n        this.drawPageBorder();\n    };\n    //Calcualte the header range for each pdf page based on schedule start and end date.\n    PdfGantt.prototype.calculateRange = function () {\n        var lastColumnRange = this.layouter.columnRanges[this.layouter.columnRanges.length - 1];\n        var totalColumnWidth = 0;\n        var isPageFinished = true;\n        var pageWidth = 0;\n        var remainWidth = 0;\n        var point = 0;\n        var headerWidth = pixelToPoint(this.chartHeader.width);\n        var timelineSettings = this.parent.timelineModule;\n        for (var index = lastColumnRange[0]; index <= lastColumnRange[1]; index++) {\n            totalColumnWidth += this.layouter.treegrid.columns.getColumn(index).width;\n        }\n        totalColumnWidth += 0.5;\n        if (totalColumnWidth + 100 < this.result.page.getClientSize().width) {\n            remainWidth = this.result.page.getClientSize().width - totalColumnWidth;\n            this.chartPageIndex = this.startPageIndex = this.totalPages - this.perColumnPages;\n            isPageFinished = false;\n            this.startPoint = new PointF(totalColumnWidth, 0);\n        }\n        else {\n            this.result.page.section.add();\n            this.chartPageIndex = this.startPageIndex = this.totalPages;\n            isPageFinished = true;\n            this.startPoint = new PointF(point, 0);\n        }\n        while (Math.round(point) < Math.round(headerWidth)) {\n            if (isPageFinished) {\n                pageWidth = this.result.page.getClientSize().width;\n            }\n            else {\n                pageWidth = remainWidth;\n                isPageFinished = true;\n            }\n            var detail = {};\n            var range = [];\n            var convertedWidth = pixelToPoint(this.chartHeader.bottomTierCellWidth);\n            var width = 0;\n            if (this.chartHeader.bottomTierCellWidth !== 0) {\n                width = (Math.floor(pageWidth / convertedWidth) * convertedWidth);\n            }\n            range[0] = point;\n            if (headerWidth - point <= width) {\n                range[1] = headerWidth;\n                detail.totalWidth = pointToPixel(headerWidth - point);\n            }\n            else {\n                range[1] = point + width;\n                detail.totalWidth = pointToPixel(width);\n            }\n            detail.startPoint = range[0];\n            detail.endPoint = range[1];\n            if (this.parent.cloneProjectStartDate.getHours() === 0 && this.parent.cloneProjectStartDate.getMinutes() === 0\n                && this.parent.cloneProjectStartDate.getSeconds() === 0) {\n                this.parent.cloneProjectStartDate.setHours(8);\n            }\n            var timelineStartDate = this.parent.dataOperation.getDateFromFormat(this.parent.cloneProjectStartDate);\n            var count = isNullOrUndefined(timelineSettings.customTimelineSettings.bottomTier.count) ?\n                timelineSettings.customTimelineSettings.topTier.count : timelineSettings.customTimelineSettings.bottomTier.count;\n            var scheduleType = timelineSettings.customTimelineSettings.bottomTier.unit === 'None' ?\n                timelineSettings.customTimelineSettings.topTier.unit : timelineSettings.customTimelineSettings.bottomTier.unit;\n            switch (scheduleType) {\n                case 'Minutes':\n                    {\n                        detail.startDate = new Date(timelineStartDate.getTime());\n                        var sDays = Math.floor(pointToPixel(detail.startPoint) / (this.chartHeader.bottomTierCellWidth));\n                        detail.startDate.setMinutes(detail.startDate.getMinutes() + sDays * count);\n                        detail.startDate.setSeconds(detail.startDate.getSeconds() + 1);\n                        detail.endDate = new Date(detail.startDate.getTime());\n                        var eDays = Math.floor(pointToPixel(detail.endPoint - detail.startPoint)\n                            / (this.chartHeader.bottomTierCellWidth));\n                        detail.endDate.setMinutes(detail.endDate.getMinutes() + eDays * count);\n                        break;\n                    }\n                case 'Hour':\n                    {\n                        detail.startDate = new Date(timelineStartDate.getTime());\n                        var sDays1 = Math.floor(pointToPixel(detail.startPoint) / (this.chartHeader.bottomTierCellWidth));\n                        detail.startDate.setHours(detail.startDate.getHours() + sDays1 * count);\n                        detail.startDate.setMinutes(detail.startDate.getMinutes() + 1);\n                        detail.endDate = new Date(detail.startDate.getTime());\n                        var eDays1 = Math.floor(pointToPixel(detail.endPoint - detail.startPoint)\n                            / (this.chartHeader.bottomTierCellWidth));\n                        detail.endDate.setHours(detail.endDate.getHours() + eDays1 * count);\n                        break;\n                    }\n                case 'Day':\n                    {\n                        detail.startDate = new Date(timelineStartDate.getTime());\n                        var startDays = (Math.round(detail.startPoint / pixelToPoint(this.chartHeader.bottomTierCellWidth)));\n                        detail.startDate.setDate(detail.startDate.getDate() + startDays * count);\n                        var endDays = Math.round(((detail.endPoint - detail.startPoint)\n                            / pixelToPoint(this.chartHeader.bottomTierCellWidth))) - 1;\n                        detail.endDate = new Date(detail.startDate.getTime());\n                        detail.endDate.setDate(detail.startDate.getDate() + endDays * count);\n                        break;\n                    }\n                case 'Week':\n                    {\n                        detail.startDate = new Date(timelineStartDate.getTime());\n                        var startDays1 = (detail.startPoint / pixelToPoint(this.chartHeader.bottomTierCellWidth) * 7);\n                        detail.startDate.setDate(detail.startDate.getDate() + startDays1 * count);\n                        var endDays1 = Math.round((detail.endPoint - detail.startPoint)\n                            / pixelToPoint(this.chartHeader.bottomTierCellWidth)) * 7 - 1;\n                        detail.endDate = new Date(detail.startDate.getTime());\n                        detail.endDate.setDate(detail.startDate.getDate() + endDays1 * count);\n                        break;\n                    }\n                case 'Month':\n                    {\n                        detail.startDate = new Date(timelineStartDate.getTime());\n                        var startDays2 = (detail.startPoint / pixelToPoint(this.chartHeader.bottomTierCellWidth) * 31);\n                        detail.startDate.setDate(detail.startDate.getDate() + startDays2 * count);\n                        var endDays2 = Math.round((detail.endPoint - detail.startPoint)\n                            / pixelToPoint(this.chartHeader.bottomTierCellWidth)) * 31 - 1;\n                        detail.endDate = new Date(detail.startDate.getTime());\n                        detail.endDate.setDate(detail.startDate.getDate() + endDays2 * count);\n                        break;\n                    }\n                case 'Year':\n                    {\n                        detail.startDate = new Date(timelineStartDate.getTime());\n                        var startDays3 = (detail.startPoint / pixelToPoint(this.chartHeader.bottomTierCellWidth) * 365);\n                        detail.startDate.setDate(detail.startDate.getDate() + startDays3 * count);\n                        var endDays3 = Math.round((detail.endPoint - detail.startPoint)\n                            / pixelToPoint(this.chartHeader.bottomTierCellWidth)) * 365 - 1;\n                        detail.endDate = new Date(detail.startDate.getTime());\n                        detail.endDate.setDate(detail.startDate.getDate() + endDays3 * count);\n                        break;\n                    }\n            }\n            this.headerDetails.push(detail);\n            point += width;\n        }\n    };\n    PdfGantt.prototype.drawPageBorder = function () {\n        var pages = this.result.page.section.getPages();\n        for (var index = 0; index < pages.length; index++) {\n            var page = pages[index];\n            var graphics = page.graphics;\n            var pageSize = page.getClientSize();\n            var pen = new PdfPen(new PdfColor(206, 206, 206));\n            graphics.drawRectangle(pen, 0, 0, pageSize.width, pageSize.height);\n        }\n    };\n    //Draw the gantt chart side\n    PdfGantt.prototype.drawGantttChart = function () {\n        var _this = this;\n        var taskbarPoint = this.startPoint;\n        var pagePoint = new PointF();\n        var pageStartX = 0;\n        var cumulativeWidth = 0;\n        var cumulativeHeight = 0;\n        var totalHeight = 0;\n        var pageData;\n        this.headerDetails.forEach(function (detail, index) {\n            var page = _this.result.page.section.getPages()[_this.startPageIndex];\n            _this.chartHeader.drawTimeline(page, _this.startPoint, detail);\n            taskbarPoint.y = taskbarPoint.y + pixelToPoint(_this.parent.timelineModule.isSingleTier ? 45 : 60); // headerHeight\n            pageStartX = taskbarPoint.x;\n            cumulativeHeight = pixelToPoint(_this.parent.timelineModule.isSingleTier ? 45 : 60); // headerHeight\n            _this.headerDetails[_this.headerDetails.indexOf(detail)].startIndex = _this.startPageIndex;\n            _this.headerDetails[_this.headerDetails.indexOf(detail)].pageStartPoint = taskbarPoint;\n            for (var i = 0; i < _this.taskbarCollection.length; i++) {\n                var task = _this.taskbarCollection[i];\n                var rowHeight = _this.rows.getRow(i + 1).height;\n                var pdfPage = _this.result.page.section.getPages()[_this.startPageIndex];\n                /* eslint-disable-next-line */\n                var isNextPage = task.drawTaskbar(pdfPage, taskbarPoint, detail, cumulativeWidth, rowHeight, _this.taskbarCollection[i]);\n                if (isNextPage) {\n                    if (_this.enableHeader) {\n                        taskbarPoint.y = pixelToPoint(_this.parent.timelineModule.isSingleTier ? 45 : 60);\n                    }\n                    else {\n                        taskbarPoint.y = 0;\n                    }\n                    _this.startPageIndex++;\n                    pageData = {};\n                    pageData.height = cumulativeHeight;\n                    pageData.pageStartX = pageStartX;\n                    pageData.startPoint = __assign({}, pagePoint);\n                    pageData.width = pixelToPoint(detail.totalWidth);\n                    _this.pdfPageDetail.push(pageData);\n                    pagePoint.y += pageData.height;\n                    if (_this.enableHeader) {\n                        cumulativeHeight = _this.chartHeader.height;\n                    }\n                    else {\n                        taskbarPoint.y = 0;\n                        cumulativeHeight = 0;\n                    }\n                }\n                taskbarPoint.y += rowHeight;\n                cumulativeHeight += rowHeight;\n                // eslint-disable-next-line\n                totalHeight += rowHeight;\n            }\n            _this.headerDetails[index].endIndex = _this.startPageIndex;\n            cumulativeWidth += detail.totalWidth;\n            pageData = {};\n            pageData.height = cumulativeHeight;\n            pageData.pageStartX = pageStartX;\n            pageData.startPoint = __assign({}, pagePoint);\n            pageData.width = pixelToPoint(detail.totalWidth);\n            _this.pdfPageDetail.push(pageData);\n            pagePoint.x += pageData.width;\n            pagePoint.y = 0;\n            if (_this.enableHeader) {\n                cumulativeHeight = _this.chartHeader.height;\n            }\n            else {\n                taskbarPoint.y = 0;\n            }\n            if (_this.headerDetails.indexOf(detail) !== _this.headerDetails.length - 1) {\n                _this.result.page.section.add();\n                _this.startPageIndex = _this.result.page.section.count - 1;\n                taskbarPoint = _this.startPoint = new PointF(0, 0);\n            }\n        });\n        // Draw predecessor line.\n        for (var i = 0; i < this.predecessorCollection.length; i++) {\n            var predecessor = this.predecessorCollection[i];\n            predecessor.drawPredecessor(this);\n        }\n    };\n    return PdfGantt;\n}(PdfTreeGrid));\nexport { PdfGantt };\n"]},"metadata":{},"sourceType":"module"}