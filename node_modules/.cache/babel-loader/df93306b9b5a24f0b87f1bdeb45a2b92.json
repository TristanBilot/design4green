{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { Cell, CellType } from '@syncfusion/ej2-grids';\nimport { VirtualContentRenderer } from '@syncfusion/ej2-grids';\nimport { InterSectionObserver } from '@syncfusion/ej2-grids';\nimport { TreeVirtualRowModelGenerator } from '../renderer/virtual-row-model-generator';\nimport * as events from '../base/constant';\nimport { isNullOrUndefined, EventHandler, getValue, setValue, Browser, debounce } from '@syncfusion/ej2-base';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport { isCountRequired } from '../utils';\n\nvar VirtualTreeContentRenderer =\n/** @class */\nfunction (_super) {\n  __extends(VirtualTreeContentRenderer, _super);\n\n  function VirtualTreeContentRenderer(parent, locator) {\n    var _this = _super.call(this, parent, locator) || this;\n\n    _this.isExpandCollapse = false;\n    _this.translateY = 0;\n    _this.maxiPage = 0;\n    _this.recordAdded = false;\n    /** @hidden */\n\n    _this.startIndex = -1;\n    _this.endIndex = -1;\n    _this.preTranslate = 0;\n    _this.isRemoteExpand = false;\n    /** @hidden */\n\n    _this.isDataSourceChanged = false;\n\n    _this.addEventListener();\n\n    return _this;\n  }\n\n  VirtualTreeContentRenderer.prototype.getModelGenerator = function () {\n    return new TreeVirtualRowModelGenerator(this.parent);\n  };\n\n  VirtualTreeContentRenderer.prototype.getRowByIndex = function (index) {\n    return this.parent.getDataRows().filter(function (e) {\n      return parseInt(e.getAttribute('aria-rowindex'), 10) === index;\n    })[0];\n  };\n\n  VirtualTreeContentRenderer.prototype.addEventListener = function () {\n    this.parent.on(events.virtualActionArgs, this.virtualOtherAction, this);\n    this.parent.on(events.indexModifier, this.indexModifier, this);\n  };\n\n  VirtualTreeContentRenderer.prototype.virtualOtherAction = function (args) {\n    if (args.setTop) {\n      this.translateY = 0;\n      this.startIndex = 0;\n      this.endIndex = this.parent.pageSettings.pageSize - 1;\n    } else if (args.isExpandCollapse) {\n      this.isExpandCollapse = true;\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.indexModifier = function (args) {\n    var content = this.parent.getContent().querySelector('.e-content');\n\n    if (this.recordAdded && this.startIndex > -1 && this.endIndex > -1) {\n      if (this.endIndex > args.count - this.parent.pageSettings.pageSize) {\n        var nextSetResIndex = ~~(content.scrollTop / this.parent.getRowHeight());\n        var lastIndex = nextSetResIndex + this.parent.getRows().length;\n\n        if (lastIndex > args.count) {\n          lastIndex = nextSetResIndex + (args.count - nextSetResIndex);\n        }\n\n        this.startIndex = lastIndex - this.parent.getRows().length;\n        this.endIndex = lastIndex;\n      } else {\n        this.startIndex += 1;\n        this.endIndex += 1;\n      }\n\n      this.recordAdded = false;\n    }\n\n    if (this.isDataSourceChanged) {\n      this.startIndex = 0;\n      this.endIndex = this.parent.pageSettings.pageSize - 1;\n    }\n\n    args.startIndex = this.startIndex;\n    args.endIndex = this.endIndex;\n  };\n\n  VirtualTreeContentRenderer.prototype.eventListener = function (action) {\n    var _this = this;\n\n    if (!(this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined && this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '') || !isCountRequired(this.parent)) {\n      this.parent[action]('data-ready', this.onDataReady, this);\n      this.parent[action]('refresh-virtual-block', this.refreshContentRows, this);\n\n      this.fn = function () {\n        _this.observers.observes(function (scrollArgs) {\n          return _this.scrollListeners(scrollArgs);\n        }, _this.onEnteredAction());\n\n        _this.parent.off('content-ready', _this.fn);\n      };\n\n      this.parent.addEventListener('dataBound', this.dataBoundEvent.bind(this));\n      this.parent.addEventListener('rowSelected', this.rowSelectedEvent.bind(this));\n      this.parent[action]('select-virtual-Row', this.toSelectVirtualRow, this);\n      this.parent.on('content-ready', this.fn, this);\n      this.parent.addEventListener(events.actionComplete, this.onActionComplete.bind(this));\n      this.parent[action]('virtual-scroll-edit-action-begin', this.beginEdit, this);\n      this.parent[action]('virtual-scroll-add-action-begin', this.beginAdd, this);\n      this.parent[action]('virtual-scroll-edit-success', this.virtualEditSuccess, this);\n      this.parent[action]('edit-reset', this.resetIseditValue, this);\n      this.parent[action]('get-virtual-data', this.getData, this);\n      this.parent[action]('virtual-scroll-edit-cancel', this.cancelEdit, this);\n      this.parent[action]('select-row-on-context-open', this.toSelectRowOnContextOpen, this);\n      this.parent[action]('refresh-virtual-editform-cells', this.refreshCell, this);\n      this.parent[action]('virtaul-cell-focus', this.cellFocus, this);\n    } else {\n      _super.prototype.eventListener.call(this, 'on');\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.cellFocus = function (e) {\n    var virtualCellFocus = 'virtualCellFocus';\n\n    _super.prototype[virtualCellFocus].call(this, e);\n  };\n\n  VirtualTreeContentRenderer.prototype.onDataReady = function (e) {\n    _super.prototype.onDataReady.call(this, e);\n\n    if (!(this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined && this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '') || !isCountRequired(this.parent)) {\n      if (!isNullOrUndefined(e.count)) {\n        this.totalRecords = e.count;\n\n        if (!this.parent.enableColumnVirtualization) {\n          getValue('virtualEle', this).setVirtualHeight(this.parent.getRowHeight() * e.count, '100%');\n        }\n      }\n\n      if (!isNullOrUndefined(e.requestType) && e.requestType.toString() === 'collapseAll' || this.isDataSourceChanged) {\n        this.contents.scrollTop = 0;\n        this.isDataSourceChanged = false;\n      }\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.renderTable = function () {\n    _super.prototype.renderTable.call(this);\n\n    if (!(this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined && this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '') || !isCountRequired(this.parent)) {\n      getValue('observer', this).options.debounceEvent = false;\n      this.observers = new TreeInterSectionObserver(getValue('observer', this).element, getValue('observer', this).options);\n      this.contents = this.getPanel().firstChild;\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.getTranslateY = function (sTop, cHeight, info, isOnenter) {\n    if (this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined && !this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '' || isCountRequired(this.parent)) {\n      if (this.isRemoteExpand) {\n        this.isRemoteExpand = false;\n        return this.preTranslate;\n      } else {\n        this.preTranslate = _super.prototype.getTranslateY.call(this, sTop, cHeight, info, isOnenter);\n        return _super.prototype.getTranslateY.call(this, sTop, cHeight, info, isOnenter);\n      }\n    } else {\n      return _super.prototype.getTranslateY.call(this, sTop, cHeight, info, isOnenter);\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.dataBoundEvent = function () {\n    var dataBoundEve = 'dataBound';\n    var initialRowTop = 'initialRowTop';\n\n    if (this.parent.getRows().length && !this[initialRowTop] && !isNullOrUndefined(this.parent.getRowByIndex(0))) {\n      var rowTop = this.parent.getRowByIndex(0).getBoundingClientRect().top;\n      var gridTop = this.parent.element.getBoundingClientRect().top;\n\n      if (rowTop > 0) {\n        this[initialRowTop] = this.parent.getRowByIndex(0).getBoundingClientRect().top - gridTop;\n      } else {\n        this[initialRowTop] = this.content.getBoundingClientRect().top - this.parent.getRowByIndex(0).getBoundingClientRect().height;\n      }\n    }\n\n    _super.prototype[dataBoundEve].call(this);\n  };\n\n  VirtualTreeContentRenderer.prototype.rowSelectedEvent = function (args) {\n    var rowSelected = 'rowSelected';\n\n    _super.prototype[rowSelected].call(this, args);\n  };\n\n  VirtualTreeContentRenderer.prototype.toSelectVirtualRow = function (args) {\n    if (this.parent.isEdit) {\n      return;\n    }\n\n    var selectVirtualRow = 'selectVirtualRow';\n    var containerRect = 'containerRect';\n\n    if (isNullOrUndefined(this.observer[containerRect])) {\n      this.observer[containerRect] = this.observers[containerRect];\n    }\n\n    _super.prototype[selectVirtualRow].call(this, args);\n  };\n\n  VirtualTreeContentRenderer.prototype.refreshCell = function (rowObj) {\n    rowObj.cells = this.generateCells();\n  };\n\n  VirtualTreeContentRenderer.prototype.generateCells = function () {\n    var cells = [];\n\n    for (var i = 0; i < this.parent.columns.length; i++) {\n      cells.push(this.generateCell(this.parent.columns[i]));\n    }\n\n    return cells;\n  };\n\n  VirtualTreeContentRenderer.prototype.generateCell = function (col, rowId, cellType, colSpan, oIndex, foreignKeyData) {\n    var opt = {\n      'visible': col.visible,\n      'isDataCell': !isNullOrUndefined(col.field || col.template),\n      'isTemplate': !isNullOrUndefined(col.template),\n      'rowID': rowId,\n      'column': col,\n      'cellType': !isNullOrUndefined(cellType) ? cellType : CellType.Data,\n      'colSpan': colSpan,\n      'commands': col.commands,\n      'isForeignKey': col.isForeignColumn && col.isForeignColumn(),\n      'foreignKeyData': col.isForeignColumn && col.isForeignColumn() && getValue(col.field, foreignKeyData)\n    };\n\n    if (opt.isDataCell || opt.column.type === 'checkbox' || opt.commands) {\n      opt.index = oIndex;\n    }\n\n    return new Cell(opt);\n  };\n\n  VirtualTreeContentRenderer.prototype.beginEdit = function (e) {\n    var selector = '.e-row[aria-rowindex=\"' + e.index + '\"]';\n    var index = this.parent.getContent().querySelector(selector).rowIndex;\n    var rowData = this.parent.getCurrentViewRecords()[index];\n    e.data = rowData;\n  };\n\n  VirtualTreeContentRenderer.prototype.beginAdd = function (args) {\n    var addAction = 'addActionBegin';\n    var isAdd = 'isAdd';\n    var addArgs = {\n      newRowPosition: this.rowPosition,\n      addRowIndex: this.addRowIndex,\n      ariaRowIndex: this.ariaRowIndex\n    };\n    this.parent.notify('get-row-position', addArgs);\n    this.rowPosition = addArgs.newRowPosition;\n    this.addRowIndex = addArgs.addRowIndex;\n    this.ariaRowIndex = addArgs.ariaRowIndex;\n    var rows = this.parent.getRows();\n    var firstAriaIndex = rows.length ? +rows[0].getAttribute('aria-rowindex') : 0;\n    var lastAriaIndex = rows.length ? +rows[rows.length - 1].getAttribute('aria-rowindex') : 0;\n    var withInRange = this.parent.selectedRowIndex >= firstAriaIndex && this.parent.selectedRowIndex <= lastAriaIndex;\n\n    if (!(this.rowPosition === 'Top' || this.rowPosition === 'Bottom')) {\n      this[isAdd] = true;\n    }\n\n    if (this.rowPosition === 'Top' || this.rowPosition === 'Bottom' || (!this.addRowIndex || this.addRowIndex === -1) && (this.parent.selectedRowIndex === -1 || !withInRange)) {\n      _super.prototype[addAction].call(this, args);\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.restoreEditState = function () {\n    var restoreEdit = 'restoreEdit';\n\n    _super.prototype[restoreEdit].call(this);\n  };\n\n  VirtualTreeContentRenderer.prototype.resetIseditValue = function () {\n    var resetIsEdit = 'resetIsedit';\n    var isAdd = 'isAdd';\n    this.parent.notify('reset-edit-props', {});\n\n    if ((this.rowPosition === 'Top' || this.rowPosition === 'Bottom') && this[isAdd]) {\n      _super.prototype[resetIsEdit].call(this);\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.virtualEditSuccess = function () {\n    var isAdd = 'isAdd';\n    var content = this.parent.getContent().querySelector('.e-content');\n\n    if (this[isAdd] && content.querySelector('.e-addedrow')) {\n      this.recordAdded = true;\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.cancelEdit = function (args) {\n    var editCancel = 'editCancel';\n\n    _super.prototype[editCancel].call(this, args);\n  };\n\n  VirtualTreeContentRenderer.prototype.toSelectRowOnContextOpen = function (args) {\n    var selectRowOnContextOpen = 'selectRowOnContextOpen';\n\n    _super.prototype[selectRowOnContextOpen].call(this, args);\n  };\n\n  VirtualTreeContentRenderer.prototype.restoreNewRow = function () {\n    var isAdd = 'isAdd';\n    var content = this.parent.getContent().querySelector('.e-content');\n\n    if (this[isAdd] && !content.querySelector('.e-addedrow')) {\n      this.parent.isEdit = false;\n      this.parent.addRecord();\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.getData = function (data) {\n    var getVirtualData = 'getVirtualData';\n\n    _super.prototype[getVirtualData].call(this, data);\n  };\n\n  VirtualTreeContentRenderer.prototype.onActionComplete = function (args) {\n    if (args.requestType === 'add') {\n      var addArgs = {\n        newRowPosition: this.rowPosition,\n        addRowIndex: this.addRowIndex,\n        ariaRowIndex: this.ariaRowIndex\n      };\n      this.parent.notify('get-row-position', addArgs);\n      this.rowPosition = addArgs.newRowPosition;\n      this.addRowIndex = addArgs.addRowIndex;\n      this.ariaRowIndex = addArgs.ariaRowIndex;\n    }\n\n    var actionComplete = 'actionComplete';\n\n    _super.prototype[actionComplete].call(this, args);\n  };\n\n  VirtualTreeContentRenderer.prototype.onEnteredAction = function () {\n    var _this = this;\n\n    return function (element, current, direction, e, isWheel, check) {\n      var directVirtualRender = 'directVirtualRender';\n\n      if (!_this.parent[directVirtualRender]) {\n        // with this property, columns are rendered without debouncing on horizontal scroll.\n        var preventEvent = 'preventEvent';\n\n        if (Browser.isIE && !isWheel && check && !_this[preventEvent]) {\n          _this.parent.showSpinner();\n        }\n\n        var xAxis = current.axis === 'X';\n\n        var x = _this.getColumnOffset(xAxis ? _this.vgenerator.getColumnIndexes()[0] - 1 : _this.prevInfo.columnIndexes[0] - 1);\n\n        if (xAxis) {\n          var idx = Object.keys(_this.vgenerator.cOffsets).length - _this.prevInfo.columnIndexes.length;\n\n          var maxLeft = _this.vgenerator.cOffsets[idx - 1];\n          x = x > maxLeft ? maxLeft : x; //TODO: This fix horizontal scrollbar jumping issue in column virtualization.\n        }\n\n        _this.virtualEle.adjustTable(x, _this.translateY);\n\n        if (_this.parent.enableColumnVirtualization) {\n          _this.header.virtualEle.adjustTable(x, 0);\n        }\n      }\n    };\n  };\n\n  VirtualTreeContentRenderer.prototype.scrollListeners = function (scrollArgs) {\n    var info = scrollArgs.sentinel;\n    var outBuffer = this.parent.pageSettings.pageSize - Math.ceil(this.parent.pageSettings.pageSize / 2);\n    var content = this.parent.getContent().querySelector('.e-content');\n    var scrollHeight = outBuffer * this.parent.getRowHeight();\n    var upScroll = scrollArgs.offset.top - this.translateY < 0;\n    var downScroll = Math.ceil(scrollArgs.offset.top - this.translateY) >= scrollHeight;\n    var selectedRowIndex = 'selectedRowIndex';\n\n    if (upScroll && scrollArgs.direction !== 'right' && scrollArgs.direction !== 'left') {\n      var vHeight = +(this.parent.height.toString().indexOf('%') < 0 ? this.parent.height : this.parent.element.getBoundingClientRect().height);\n      var index = ~~(content.scrollTop / this.parent.getRowHeight()) + Math.ceil(vHeight / this.parent.getRowHeight()) - this.parent.pageSettings.pageSize;\n      index = index > 0 ? index : 0;\n\n      if (!isNullOrUndefined(this[selectedRowIndex]) && this[selectedRowIndex] !== -1 && index !== this[selectedRowIndex]) {\n        index = this[selectedRowIndex];\n      }\n\n      this.startIndex = index;\n      this.endIndex = index + this.parent.pageSettings.pageSize;\n\n      if (this.endIndex > this.totalRecords) {\n        var lastInx = this.totalRecords - 1;\n        var remains = this.endIndex % lastInx;\n        this.endIndex = lastInx;\n        this.startIndex = this.startIndex - remains < 0 ? 0 : this.startIndex - remains;\n      } //var firsttdinx = parseInt(this.parent.getContent().querySelector('.e-content td').getAttribute('index'), 0);\n\n\n      var rowPt = Math.ceil(scrollArgs.offset.top / this.parent.getRowHeight());\n      rowPt = rowPt % this.parent.pageSettings.pageSize;\n      var firsttdinx = 0;\n\n      if (!isNullOrUndefined(this.parent.getRows()[rowPt]) && !isNullOrUndefined(this.parent.getContent().querySelectorAll('.e-content tr')[rowPt])) {\n        var attr = this.parent.getContent().querySelectorAll('.e-content tr')[rowPt].querySelector('td').getAttribute('index');\n        firsttdinx = +attr; // this.parent.getContent().querySelector('.e-content tr').getAttribute('aria-rowindex');\n      }\n\n      if (firsttdinx === 0) {\n        this.translateY = scrollArgs.offset.top;\n      } else {\n        var height = this.parent.getRowHeight();\n        this.translateY = scrollArgs.offset.top - outBuffer * height > 0 ? scrollArgs.offset.top - outBuffer * height + 10 : 0;\n      }\n    } else if (downScroll && scrollArgs.direction !== 'right' && scrollArgs.direction !== 'left') {\n      var nextSetResIndex = ~~(content.scrollTop / this.parent.getRowHeight());\n      var isLastBlock = this[selectedRowIndex] + this.parent.pageSettings.pageSize < this.totalRecords ? false : true;\n\n      if (!isNullOrUndefined(this[selectedRowIndex]) && this[selectedRowIndex] !== -1 && nextSetResIndex !== this[selectedRowIndex] && !isLastBlock) {\n        nextSetResIndex = this[selectedRowIndex];\n      }\n\n      var lastIndex = nextSetResIndex + this.parent.pageSettings.pageSize;\n\n      if (lastIndex > this.totalRecords) {\n        lastIndex = nextSetResIndex + (this.totalRecords - nextSetResIndex);\n      }\n\n      this.startIndex = !isLastBlock ? lastIndex - this.parent.pageSettings.pageSize : nextSetResIndex;\n      this.endIndex = lastIndex;\n\n      if (scrollArgs.offset.top > this.parent.getRowHeight() * this.totalRecords) {\n        this.translateY = this.getTranslateY(scrollArgs.offset.top, content.getBoundingClientRect().height);\n      } else {\n        this.translateY = scrollArgs.offset.top;\n      }\n    }\n\n    if (downScroll && scrollArgs.offset.top < this.parent.getRowHeight() * this.totalRecords || upScroll || scrollArgs.direction === 'right' || scrollArgs.direction === 'left') {\n      var viewInfo = this.currentInfo = getValue('getInfoFromView', this).apply(this, [scrollArgs.direction, info, scrollArgs.offset]);\n      this.previousInfo = viewInfo;\n      this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization ? viewInfo.columnIndexes : []);\n      var page = viewInfo.loadNext && !viewInfo.loadSelf ? viewInfo.nextInfo.page : viewInfo.page;\n      this.parent.setProperties({\n        pageSettings: {\n          currentPage: page\n        }\n      }, true);\n\n      if (scrollArgs.direction !== 'right' && scrollArgs.direction !== 'left') {\n        viewInfo.event = viewInfo.event === 'refresh-virtual-block' ? 'model-changed' : viewInfo.event;\n      }\n\n      this.parent.notify(viewInfo.event, {\n        requestType: 'virtualscroll',\n        virtualInfo: viewInfo,\n        focusElement: scrollArgs.focusElement\n      });\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.appendContent = function (target, newChild, e) {\n    if (this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined && !this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '' || isCountRequired(this.parent)) {\n      if (getValue('isExpandCollapse', e)) {\n        this.isRemoteExpand = true;\n      }\n\n      _super.prototype.appendContent.call(this, target, newChild, e);\n    } else {\n      var info = e.virtualInfo.sentinelInfo && e.virtualInfo.sentinelInfo.axis === 'Y' && getValue('currentInfo', this).page && getValue('currentInfo', this).page !== e.virtualInfo.page ? getValue('currentInfo', this) : e.virtualInfo;\n      var cBlock = info.columnIndexes[0] - 1;\n      var cOffset = this.getColumnOffset(cBlock);\n      var width = void 0;\n\n      if (this.parent.enableColumnVirtualization) {\n        this.header.virtualEle.adjustTable(cOffset, 0);\n        var cIndex = info.columnIndexes;\n        width = this.getColumnOffset(cIndex[cIndex.length - 1]) - this.getColumnOffset(cIndex[0] - 1) + '';\n        this.header.virtualEle.setWrapperWidth(width);\n      }\n\n      this.virtualEle.setWrapperWidth(width, Browser.isIE || Browser.info.name === 'edge');\n      target = this.parent.createElement('tbody');\n      target.appendChild(newChild);\n      var replace = 'replaceWith';\n      this.getTable().querySelector('tbody')[replace](target);\n\n      if (!this.isExpandCollapse || this.translateY === 0) {\n        getValue('virtualEle', this).adjustTable(cOffset, this.translateY);\n      } else {\n        this.isExpandCollapse = false;\n      }\n\n      setValue('prevInfo', this.previousInfo ? this.previousInfo : info, this);\n\n      if (e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n        this.parent.notify(events.autoCol, {});\n      }\n\n      var focusCell = 'focusCell';\n      var restoreAdd = 'restoreAdd';\n      var ensureSelectedRowPosition = 'ensureSelectedRowPosition';\n\n      _super.prototype[focusCell].call(this, e);\n\n      var isAdd = 'isAdd';\n\n      if (this[isAdd] && !this.parent.getContent().querySelector('.e-content').querySelector('.e-addedrow')) {\n        if (!(this.rowPosition === 'Top' || this.rowPosition === 'Bottom')) {\n          if (this.ariaRowIndex >= this.startIndex) {\n            this.restoreNewRow();\n          } else if (this.addRowIndex && this.addRowIndex > -1) {\n            this[isAdd] = false;\n            this.parent.isEdit = false;\n          }\n        }\n      }\n\n      this.restoreEditState();\n\n      _super.prototype[restoreAdd].call(this);\n\n      _super.prototype[ensureSelectedRowPosition].call(this);\n    }\n  };\n\n  VirtualTreeContentRenderer.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off('data-ready', this.onDataReady);\n    this.parent.off('content-ready', this.fn);\n    this.parent.off('select-virtual-Row', this.toSelectVirtualRow);\n    this.parent.off('dataBound', this.dataBoundEvent);\n    this.parent.off('rowSelected', this.rowSelectedEvent);\n    this.parent.off(events.virtualActionArgs, this.virtualOtherAction);\n    this.parent.off(events.indexModifier, this.indexModifier);\n    this.parent.off('virtual-scroll-edit-action-begin', this.beginEdit);\n    this.parent.off('virtual-scroll-add-action-begin', this.beginAdd);\n    this.parent.off('virtual-scroll-edit-success', this.virtualEditSuccess);\n    this.parent.off('edit-reset', this.resetIseditValue);\n    this.parent.off('get-virtual-data', this.getData);\n    this.parent.off('virtual-scroll-edit-cancel', this.cancelEdit);\n    this.parent.off('select-row-on-context-open', this.toSelectRowOnContextOpen);\n    this.parent.off('refresh-virtual-editform-cells', this.refreshCell);\n    this.parent.off('virtaul-cell-focus', this.cellFocus);\n  };\n\n  return VirtualTreeContentRenderer;\n}(VirtualContentRenderer);\n\nexport { VirtualTreeContentRenderer };\n\nvar TreeInterSectionObserver =\n/** @class */\nfunction (_super) {\n  __extends(TreeInterSectionObserver, _super);\n\n  function TreeInterSectionObserver() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.isWheeling = false;\n    _this.newPos = 0;\n    _this.lastPos = 0;\n    _this.timer = 0;\n    return _this;\n  }\n\n  TreeInterSectionObserver.prototype.observes = function (callback, onEnterCallback) {\n    var containerRect = 'containerRect';\n    _super.prototype[containerRect] = getValue('options', this).container.getBoundingClientRect();\n    EventHandler.add(getValue('options', this).container, 'scroll', this.virtualScrollHandlers(callback, onEnterCallback), this);\n  };\n\n  TreeInterSectionObserver.prototype.clear = function () {\n    this.lastPos = null;\n  };\n\n  TreeInterSectionObserver.prototype.virtualScrollHandlers = function (callback, onEnterCallback) {\n    var _this = this;\n\n    var delay = Browser.info.name === 'chrome' ? 200 : 100;\n    var options = 'options';\n    var movableEle = 'movableEle';\n    var element = 'element';\n    var fromWheel = 'fromWheel';\n    var debounced100 = debounce(callback, delay);\n    var debounced50 = debounce(callback, 50);\n    this[options].prevTop = this[options].prevLeft = 0;\n    return function (e) {\n      var top = _this[options].movableContainer ? _this[options].container.scrollTop : e.target.scrollTop;\n      var left = _this[options].movableContainer ? _this[options].scrollbar.scrollLeft : e.target.scrollLeft;\n      var direction = _this[options].prevTop < top ? 'down' : 'up';\n      direction = _this[options].prevLeft === left ? direction : _this[options].prevLeft < left ? 'right' : 'left';\n      _this[options].prevTop = top;\n      _this[options].prevLeft = left;\n      var current = _this.sentinelInfo[direction];\n      var delta = 0;\n      _this.newPos = top;\n\n      if (_this.lastPos != null) {\n        // && newPos < maxScroll\n        delta = _this.newPos - _this.lastPos;\n      }\n\n      _this.lastPos = _this.newPos;\n\n      if (_this.timer) {\n        clearTimeout(_this.timer);\n      }\n\n      _this.timer = setTimeout(_this.clear, 0);\n\n      if ((delta > 100 || delta < -100) && e && e.preventDefault) {\n        e.returnValue = false;\n        e.preventDefault();\n      }\n\n      if (_this[options].axes.indexOf(current.axis) === -1) {\n        return;\n      }\n\n      var check = _this.check(direction);\n\n      if (current.entered && current.axis === 'X') {\n        if (_this[movableEle] && (direction === 'right' || direction === 'left')) {\n          onEnterCallback(_this[movableEle], current, direction, {\n            top: top,\n            left: left\n          }, _this[fromWheel], check);\n        } else {\n          onEnterCallback(_this[element], current, direction, {\n            top: top,\n            left: left\n          }, _this[fromWheel], check);\n        }\n      }\n\n      if (check) {\n        var fn = debounced100;\n\n        if (current.axis === 'X') {\n          fn = debounced50;\n          fn({\n            direction: direction,\n            sentinel: current,\n            offset: {\n              top: top,\n              left: left\n            },\n            focusElement: document.activeElement\n          });\n        } else {\n          callback({\n            direction: direction,\n            sentinel: current,\n            offset: {\n              top: top,\n              left: left\n            },\n            focusElement: document.activeElement\n          });\n        }\n      }\n\n      _this[fromWheel] = false;\n    };\n  };\n\n  return TreeInterSectionObserver;\n}(InterSectionObserver);\n\nexport { TreeInterSectionObserver };","map":{"version":3,"sources":["/Users/tristanbilot/Desktop/Design4green/design4green/node_modules/@syncfusion/ej2-treegrid/src/treegrid/renderer/virtual-tree-content-render.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Cell","CellType","VirtualContentRenderer","InterSectionObserver","TreeVirtualRowModelGenerator","events","isNullOrUndefined","EventHandler","getValue","setValue","Browser","debounce","DataManager","isCountRequired","VirtualTreeContentRenderer","_super","parent","locator","_this","call","isExpandCollapse","translateY","maxiPage","recordAdded","startIndex","endIndex","preTranslate","isRemoteExpand","isDataSourceChanged","addEventListener","getModelGenerator","getRowByIndex","index","getDataRows","filter","e","parseInt","getAttribute","on","virtualActionArgs","virtualOtherAction","indexModifier","args","setTop","pageSettings","pageSize","content","getContent","querySelector","count","nextSetResIndex","scrollTop","getRowHeight","lastIndex","getRows","length","eventListener","action","dataSource","url","undefined","offline","onDataReady","refreshContentRows","fn","observers","observes","scrollArgs","scrollListeners","onEnteredAction","off","dataBoundEvent","bind","rowSelectedEvent","toSelectVirtualRow","actionComplete","onActionComplete","beginEdit","beginAdd","virtualEditSuccess","resetIseditValue","getData","cancelEdit","toSelectRowOnContextOpen","refreshCell","cellFocus","virtualCellFocus","totalRecords","enableColumnVirtualization","setVirtualHeight","requestType","toString","contents","renderTable","options","debounceEvent","TreeInterSectionObserver","element","getPanel","firstChild","getTranslateY","sTop","cHeight","info","isOnenter","dataBoundEve","initialRowTop","rowTop","getBoundingClientRect","top","gridTop","height","rowSelected","isEdit","selectVirtualRow","containerRect","observer","rowObj","cells","generateCells","i","columns","push","generateCell","col","rowId","cellType","colSpan","oIndex","foreignKeyData","opt","visible","field","template","Data","commands","isForeignColumn","isDataCell","column","type","selector","rowIndex","rowData","getCurrentViewRecords","data","addAction","isAdd","addArgs","newRowPosition","rowPosition","addRowIndex","ariaRowIndex","notify","rows","firstAriaIndex","lastAriaIndex","withInRange","selectedRowIndex","restoreEditState","restoreEdit","resetIsEdit","editCancel","selectRowOnContextOpen","restoreNewRow","addRecord","getVirtualData","current","direction","isWheel","check","directVirtualRender","preventEvent","isIE","showSpinner","xAxis","axis","x","getColumnOffset","vgenerator","getColumnIndexes","prevInfo","columnIndexes","idx","keys","cOffsets","maxLeft","virtualEle","adjustTable","header","sentinel","outBuffer","Math","ceil","scrollHeight","upScroll","offset","downScroll","vHeight","indexOf","lastInx","remains","rowPt","firsttdinx","querySelectorAll","attr","isLastBlock","viewInfo","currentInfo","apply","previousInfo","setColumnIndexesInView","page","loadNext","loadSelf","nextInfo","setProperties","currentPage","event","virtualInfo","focusElement","appendContent","target","newChild","sentinelInfo","cBlock","cOffset","width","cIndex","setWrapperWidth","name","createElement","appendChild","replace","getTable","autoCol","focusCell","restoreAdd","ensureSelectedRowPosition","removeEventListener","isDestroyed","arguments","isWheeling","newPos","lastPos","timer","callback","onEnterCallback","container","add","virtualScrollHandlers","clear","delay","movableEle","fromWheel","debounced100","debounced50","prevTop","prevLeft","movableContainer","left","scrollbar","scrollLeft","delta","clearTimeout","setTimeout","preventDefault","returnValue","axes","entered","document","activeElement"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Cell, CellType } from '@syncfusion/ej2-grids';\nimport { VirtualContentRenderer } from '@syncfusion/ej2-grids';\nimport { InterSectionObserver } from '@syncfusion/ej2-grids';\nimport { TreeVirtualRowModelGenerator } from '../renderer/virtual-row-model-generator';\nimport * as events from '../base/constant';\nimport { isNullOrUndefined, EventHandler, getValue, setValue, Browser, debounce } from '@syncfusion/ej2-base';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport { isCountRequired } from '../utils';\nvar VirtualTreeContentRenderer = /** @class */ (function (_super) {\n    __extends(VirtualTreeContentRenderer, _super);\n    function VirtualTreeContentRenderer(parent, locator) {\n        var _this = _super.call(this, parent, locator) || this;\n        _this.isExpandCollapse = false;\n        _this.translateY = 0;\n        _this.maxiPage = 0;\n        _this.recordAdded = false;\n        /** @hidden */\n        _this.startIndex = -1;\n        _this.endIndex = -1;\n        _this.preTranslate = 0;\n        _this.isRemoteExpand = false;\n        /** @hidden */\n        _this.isDataSourceChanged = false;\n        _this.addEventListener();\n        return _this;\n    }\n    VirtualTreeContentRenderer.prototype.getModelGenerator = function () {\n        return new TreeVirtualRowModelGenerator(this.parent);\n    };\n    VirtualTreeContentRenderer.prototype.getRowByIndex = function (index) {\n        return this.parent.getDataRows().filter(function (e) { return parseInt(e.getAttribute('aria-rowindex'), 10) === index; })[0];\n    };\n    VirtualTreeContentRenderer.prototype.addEventListener = function () {\n        this.parent.on(events.virtualActionArgs, this.virtualOtherAction, this);\n        this.parent.on(events.indexModifier, this.indexModifier, this);\n    };\n    VirtualTreeContentRenderer.prototype.virtualOtherAction = function (args) {\n        if (args.setTop) {\n            this.translateY = 0;\n            this.startIndex = 0;\n            this.endIndex = this.parent.pageSettings.pageSize - 1;\n        }\n        else if (args.isExpandCollapse) {\n            this.isExpandCollapse = true;\n        }\n    };\n    VirtualTreeContentRenderer.prototype.indexModifier = function (args) {\n        var content = this.parent.getContent().querySelector('.e-content');\n        if (this.recordAdded && this.startIndex > -1 && this.endIndex > -1) {\n            if (this.endIndex > args.count - this.parent.pageSettings.pageSize) {\n                var nextSetResIndex = ~~(content.scrollTop / this.parent.getRowHeight());\n                var lastIndex = nextSetResIndex + this.parent.getRows().length;\n                if (lastIndex > args.count) {\n                    lastIndex = nextSetResIndex +\n                        (args.count - nextSetResIndex);\n                }\n                this.startIndex = lastIndex - this.parent.getRows().length;\n                this.endIndex = lastIndex;\n            }\n            else {\n                this.startIndex += 1;\n                this.endIndex += 1;\n            }\n            this.recordAdded = false;\n        }\n        if (this.isDataSourceChanged) {\n            this.startIndex = 0;\n            this.endIndex = this.parent.pageSettings.pageSize - 1;\n        }\n        args.startIndex = this.startIndex;\n        args.endIndex = this.endIndex;\n    };\n    VirtualTreeContentRenderer.prototype.eventListener = function (action) {\n        var _this = this;\n        if (!(this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined\n            && this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '') || !isCountRequired(this.parent)) {\n            this.parent[action]('data-ready', this.onDataReady, this);\n            this.parent[action]('refresh-virtual-block', this.refreshContentRows, this);\n            this.fn = function () {\n                _this.observers.observes(function (scrollArgs) { return _this.scrollListeners(scrollArgs); }, _this.onEnteredAction());\n                _this.parent.off('content-ready', _this.fn);\n            };\n            this.parent.addEventListener('dataBound', this.dataBoundEvent.bind(this));\n            this.parent.addEventListener('rowSelected', this.rowSelectedEvent.bind(this));\n            this.parent[action]('select-virtual-Row', this.toSelectVirtualRow, this);\n            this.parent.on('content-ready', this.fn, this);\n            this.parent.addEventListener(events.actionComplete, this.onActionComplete.bind(this));\n            this.parent[action]('virtual-scroll-edit-action-begin', this.beginEdit, this);\n            this.parent[action]('virtual-scroll-add-action-begin', this.beginAdd, this);\n            this.parent[action]('virtual-scroll-edit-success', this.virtualEditSuccess, this);\n            this.parent[action]('edit-reset', this.resetIseditValue, this);\n            this.parent[action]('get-virtual-data', this.getData, this);\n            this.parent[action]('virtual-scroll-edit-cancel', this.cancelEdit, this);\n            this.parent[action]('select-row-on-context-open', this.toSelectRowOnContextOpen, this);\n            this.parent[action]('refresh-virtual-editform-cells', this.refreshCell, this);\n            this.parent[action]('virtaul-cell-focus', this.cellFocus, this);\n        }\n        else {\n            _super.prototype.eventListener.call(this, 'on');\n        }\n    };\n    VirtualTreeContentRenderer.prototype.cellFocus = function (e) {\n        var virtualCellFocus = 'virtualCellFocus';\n        _super.prototype[virtualCellFocus].call(this, e);\n    };\n    VirtualTreeContentRenderer.prototype.onDataReady = function (e) {\n        _super.prototype.onDataReady.call(this, e);\n        if (!(this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined\n            && this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '') || !isCountRequired(this.parent)) {\n            if (!isNullOrUndefined(e.count)) {\n                this.totalRecords = e.count;\n                if (!this.parent.enableColumnVirtualization) {\n                    getValue('virtualEle', this).setVirtualHeight(this.parent.getRowHeight() * e.count, '100%');\n                }\n            }\n            if ((!isNullOrUndefined(e.requestType) && e.requestType.toString() === 'collapseAll') || this.isDataSourceChanged) {\n                this.contents.scrollTop = 0;\n                this.isDataSourceChanged = false;\n            }\n        }\n    };\n    VirtualTreeContentRenderer.prototype.renderTable = function () {\n        _super.prototype.renderTable.call(this);\n        if (!(this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined\n            && this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '') || !isCountRequired(this.parent)) {\n            getValue('observer', this).options.debounceEvent = false;\n            this.observers = new TreeInterSectionObserver(getValue('observer', this).element, getValue('observer', this).options);\n            this.contents = this.getPanel().firstChild;\n        }\n    };\n    VirtualTreeContentRenderer.prototype.getTranslateY = function (sTop, cHeight, info, isOnenter) {\n        if ((this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined\n            && !this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '') || isCountRequired(this.parent)) {\n            if (this.isRemoteExpand) {\n                this.isRemoteExpand = false;\n                return this.preTranslate;\n            }\n            else {\n                this.preTranslate = _super.prototype.getTranslateY.call(this, sTop, cHeight, info, isOnenter);\n                return _super.prototype.getTranslateY.call(this, sTop, cHeight, info, isOnenter);\n            }\n        }\n        else {\n            return _super.prototype.getTranslateY.call(this, sTop, cHeight, info, isOnenter);\n        }\n    };\n    VirtualTreeContentRenderer.prototype.dataBoundEvent = function () {\n        var dataBoundEve = 'dataBound';\n        var initialRowTop = 'initialRowTop';\n        if (this.parent.getRows().length && !this[initialRowTop] && !isNullOrUndefined(this.parent.getRowByIndex(0))) {\n            var rowTop = this.parent.getRowByIndex(0).getBoundingClientRect().top;\n            var gridTop = this.parent.element.getBoundingClientRect().top;\n            if (rowTop > 0) {\n                this[initialRowTop] = this.parent.getRowByIndex(0).getBoundingClientRect().top - gridTop;\n            }\n            else {\n                this[initialRowTop] = this.content.getBoundingClientRect().top -\n                    this.parent.getRowByIndex(0).getBoundingClientRect().height;\n            }\n        }\n        _super.prototype[dataBoundEve].call(this);\n    };\n    VirtualTreeContentRenderer.prototype.rowSelectedEvent = function (args) {\n        var rowSelected = 'rowSelected';\n        _super.prototype[rowSelected].call(this, args);\n    };\n    VirtualTreeContentRenderer.prototype.toSelectVirtualRow = function (args) {\n        if (this.parent.isEdit) {\n            return;\n        }\n        var selectVirtualRow = 'selectVirtualRow';\n        var containerRect = 'containerRect';\n        if (isNullOrUndefined(this.observer[containerRect])) {\n            this.observer[containerRect] = this.observers[containerRect];\n        }\n        _super.prototype[selectVirtualRow].call(this, args);\n    };\n    VirtualTreeContentRenderer.prototype.refreshCell = function (rowObj) {\n        rowObj.cells = this.generateCells();\n    };\n    VirtualTreeContentRenderer.prototype.generateCells = function () {\n        var cells = [];\n        for (var i = 0; i < this.parent.columns.length; i++) {\n            cells.push(this.generateCell(this.parent.columns[i]));\n        }\n        return cells;\n    };\n    VirtualTreeContentRenderer.prototype.generateCell = function (col, rowId, cellType, colSpan, oIndex, foreignKeyData) {\n        var opt = {\n            'visible': col.visible,\n            'isDataCell': !isNullOrUndefined(col.field || col.template),\n            'isTemplate': !isNullOrUndefined(col.template),\n            'rowID': rowId,\n            'column': col,\n            'cellType': !isNullOrUndefined(cellType) ? cellType : CellType.Data,\n            'colSpan': colSpan,\n            'commands': col.commands,\n            'isForeignKey': col.isForeignColumn && col.isForeignColumn(),\n            'foreignKeyData': col.isForeignColumn && col.isForeignColumn() && getValue(col.field, foreignKeyData)\n        };\n        if (opt.isDataCell || opt.column.type === 'checkbox' || opt.commands) {\n            opt.index = oIndex;\n        }\n        return new Cell(opt);\n    };\n    VirtualTreeContentRenderer.prototype.beginEdit = function (e) {\n        var selector = '.e-row[aria-rowindex=\"' + e.index + '\"]';\n        var index = this.parent.getContent().querySelector(selector).rowIndex;\n        var rowData = this.parent.getCurrentViewRecords()[index];\n        e.data = rowData;\n    };\n    VirtualTreeContentRenderer.prototype.beginAdd = function (args) {\n        var addAction = 'addActionBegin';\n        var isAdd = 'isAdd';\n        var addArgs = { newRowPosition: this.rowPosition, addRowIndex: this.addRowIndex, ariaRowIndex: this.ariaRowIndex };\n        this.parent.notify('get-row-position', addArgs);\n        this.rowPosition = addArgs.newRowPosition;\n        this.addRowIndex = addArgs.addRowIndex;\n        this.ariaRowIndex = addArgs.ariaRowIndex;\n        var rows = this.parent.getRows();\n        var firstAriaIndex = rows.length ? +rows[0].getAttribute('aria-rowindex') : 0;\n        var lastAriaIndex = rows.length ? +rows[rows.length - 1].getAttribute('aria-rowindex') : 0;\n        var withInRange = this.parent.selectedRowIndex >= firstAriaIndex && this.parent.selectedRowIndex <= lastAriaIndex;\n        if (!(this.rowPosition === 'Top' || this.rowPosition === 'Bottom')) {\n            this[isAdd] = true;\n        }\n        if (this.rowPosition === 'Top' || this.rowPosition === 'Bottom' ||\n            ((!this.addRowIndex || this.addRowIndex === -1) && (this.parent.selectedRowIndex === -1 || !withInRange))) {\n            _super.prototype[addAction].call(this, args);\n        }\n    };\n    VirtualTreeContentRenderer.prototype.restoreEditState = function () {\n        var restoreEdit = 'restoreEdit';\n        _super.prototype[restoreEdit].call(this);\n    };\n    VirtualTreeContentRenderer.prototype.resetIseditValue = function () {\n        var resetIsEdit = 'resetIsedit';\n        var isAdd = 'isAdd';\n        this.parent.notify('reset-edit-props', {});\n        if ((this.rowPosition === 'Top' || this.rowPosition === 'Bottom') && this[isAdd]) {\n            _super.prototype[resetIsEdit].call(this);\n        }\n    };\n    VirtualTreeContentRenderer.prototype.virtualEditSuccess = function () {\n        var isAdd = 'isAdd';\n        var content = this.parent.getContent().querySelector('.e-content');\n        if (this[isAdd] && content.querySelector('.e-addedrow')) {\n            this.recordAdded = true;\n        }\n    };\n    VirtualTreeContentRenderer.prototype.cancelEdit = function (args) {\n        var editCancel = 'editCancel';\n        _super.prototype[editCancel].call(this, args);\n    };\n    VirtualTreeContentRenderer.prototype.toSelectRowOnContextOpen = function (args) {\n        var selectRowOnContextOpen = 'selectRowOnContextOpen';\n        _super.prototype[selectRowOnContextOpen].call(this, args);\n    };\n    VirtualTreeContentRenderer.prototype.restoreNewRow = function () {\n        var isAdd = 'isAdd';\n        var content = this.parent.getContent().querySelector('.e-content');\n        if (this[isAdd] && !content.querySelector('.e-addedrow')) {\n            this.parent.isEdit = false;\n            this.parent.addRecord();\n        }\n    };\n    VirtualTreeContentRenderer.prototype.getData = function (data) {\n        var getVirtualData = 'getVirtualData';\n        _super.prototype[getVirtualData].call(this, data);\n    };\n    VirtualTreeContentRenderer.prototype.onActionComplete = function (args) {\n        if (args.requestType === 'add') {\n            var addArgs = { newRowPosition: this.rowPosition, addRowIndex: this.addRowIndex, ariaRowIndex: this.ariaRowIndex };\n            this.parent.notify('get-row-position', addArgs);\n            this.rowPosition = addArgs.newRowPosition;\n            this.addRowIndex = addArgs.addRowIndex;\n            this.ariaRowIndex = addArgs.ariaRowIndex;\n        }\n        var actionComplete = 'actionComplete';\n        _super.prototype[actionComplete].call(this, args);\n    };\n    VirtualTreeContentRenderer.prototype.onEnteredAction = function () {\n        var _this = this;\n        return function (element, current, direction, e, isWheel, check) {\n            var directVirtualRender = 'directVirtualRender';\n            if (!_this.parent[directVirtualRender]) { // with this property, columns are rendered without debouncing on horizontal scroll.\n                var preventEvent = 'preventEvent';\n                if (Browser.isIE && !isWheel && check && !_this[preventEvent]) {\n                    _this.parent.showSpinner();\n                }\n                var xAxis = current.axis === 'X';\n                var x = _this.getColumnOffset(xAxis ? _this.vgenerator.getColumnIndexes()[0] - 1 : _this.prevInfo.columnIndexes[0]\n                    - 1);\n                if (xAxis) {\n                    var idx = Object.keys(_this.vgenerator.cOffsets).length - _this.prevInfo.columnIndexes.length;\n                    var maxLeft = _this.vgenerator.cOffsets[idx - 1];\n                    x = x > maxLeft ? maxLeft : x; //TODO: This fix horizontal scrollbar jumping issue in column virtualization.\n                }\n                _this.virtualEle.adjustTable(x, _this.translateY);\n                if (_this.parent.enableColumnVirtualization) {\n                    _this.header.virtualEle.adjustTable(x, 0);\n                }\n            }\n        };\n    };\n    VirtualTreeContentRenderer.prototype.scrollListeners = function (scrollArgs) {\n        var info = scrollArgs.sentinel;\n        var outBuffer = this.parent.pageSettings.pageSize - Math.ceil(this.parent.pageSettings.pageSize / 2);\n        var content = this.parent.getContent().querySelector('.e-content');\n        var scrollHeight = outBuffer * this.parent.getRowHeight();\n        var upScroll = (scrollArgs.offset.top - this.translateY) < 0;\n        var downScroll = Math.ceil(scrollArgs.offset.top - this.translateY) >= scrollHeight;\n        var selectedRowIndex = 'selectedRowIndex';\n        if (upScroll && (scrollArgs.direction !== 'right' && scrollArgs.direction !== 'left')) {\n            var vHeight = +(this.parent.height.toString().indexOf('%') < 0 ? this.parent.height :\n                this.parent.element.getBoundingClientRect().height);\n            var index = (~~(content.scrollTop / this.parent.getRowHeight())\n                + Math.ceil(vHeight / this.parent.getRowHeight()))\n                - this.parent.pageSettings.pageSize;\n            index = (index > 0) ? index : 0;\n            if (!isNullOrUndefined(this[selectedRowIndex]) && this[selectedRowIndex] !== -1 && index !== this[selectedRowIndex]) {\n                index = this[selectedRowIndex];\n            }\n            this.startIndex = index;\n            this.endIndex = index + this.parent.pageSettings.pageSize;\n            if (this.endIndex > this.totalRecords) {\n                var lastInx = this.totalRecords - 1;\n                var remains = this.endIndex % lastInx;\n                this.endIndex = lastInx;\n                this.startIndex = (this.startIndex - remains) < 0 ? 0 : (this.startIndex - remains);\n            }\n            //var firsttdinx = parseInt(this.parent.getContent().querySelector('.e-content td').getAttribute('index'), 0);\n            var rowPt = Math.ceil(scrollArgs.offset.top / this.parent.getRowHeight());\n            rowPt = rowPt % this.parent.pageSettings.pageSize;\n            var firsttdinx = 0;\n            if (!isNullOrUndefined(this.parent.getRows()[rowPt]) &&\n                !isNullOrUndefined(this.parent.getContent().querySelectorAll('.e-content tr')[rowPt])) {\n                var attr = this.parent.getContent().querySelectorAll('.e-content tr')[rowPt]\n                    .querySelector('td').getAttribute('index');\n                firsttdinx = +attr; // this.parent.getContent().querySelector('.e-content tr').getAttribute('aria-rowindex');\n            }\n            if (firsttdinx === 0) {\n                this.translateY = scrollArgs.offset.top;\n            }\n            else {\n                var height = this.parent.getRowHeight();\n                this.translateY = (scrollArgs.offset.top - (outBuffer * height) > 0) ?\n                    scrollArgs.offset.top - (outBuffer * height) + 10 : 0;\n            }\n        }\n        else if (downScroll && (scrollArgs.direction !== 'right' && scrollArgs.direction !== 'left')) {\n            var nextSetResIndex = ~~(content.scrollTop / this.parent.getRowHeight());\n            var isLastBlock = (this[selectedRowIndex] + this.parent.pageSettings.pageSize) < this.totalRecords ? false : true;\n            if (!isNullOrUndefined(this[selectedRowIndex]) && this[selectedRowIndex] !== -1 &&\n                nextSetResIndex !== this[selectedRowIndex] && !isLastBlock) {\n                nextSetResIndex = this[selectedRowIndex];\n            }\n            var lastIndex = nextSetResIndex + this.parent.pageSettings.pageSize;\n            if (lastIndex > this.totalRecords) {\n                lastIndex = nextSetResIndex +\n                    (this.totalRecords - nextSetResIndex);\n            }\n            this.startIndex = !isLastBlock ? lastIndex - this.parent.pageSettings.pageSize : nextSetResIndex;\n            this.endIndex = lastIndex;\n            if (scrollArgs.offset.top > (this.parent.getRowHeight() * this.totalRecords)) {\n                this.translateY = this.getTranslateY(scrollArgs.offset.top, content.getBoundingClientRect().height);\n            }\n            else {\n                this.translateY = scrollArgs.offset.top;\n            }\n        }\n        if (((downScroll && (scrollArgs.offset.top < (this.parent.getRowHeight() * this.totalRecords)))\n            || (upScroll)) || (scrollArgs.direction === 'right' || scrollArgs.direction === 'left')) {\n            var viewInfo = this.currentInfo = getValue('getInfoFromView', this).apply(this, [scrollArgs.direction, info, scrollArgs.offset]);\n            this.previousInfo = viewInfo;\n            this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization ? viewInfo.columnIndexes : []);\n            var page = viewInfo.loadNext && !viewInfo.loadSelf ? viewInfo.nextInfo.page : viewInfo.page;\n            this.parent.setProperties({ pageSettings: { currentPage: page } }, true);\n            if (scrollArgs.direction !== 'right' && scrollArgs.direction !== 'left') {\n                viewInfo.event = viewInfo.event === 'refresh-virtual-block' ? 'model-changed' : viewInfo.event;\n            }\n            this.parent.notify(viewInfo.event, { requestType: 'virtualscroll', virtualInfo: viewInfo, focusElement: scrollArgs.focusElement });\n        }\n    };\n    VirtualTreeContentRenderer.prototype.appendContent = function (target, newChild, e) {\n        if ((this.parent.dataSource instanceof DataManager && this.parent.dataSource.dataSource.url !== undefined\n            && !this.parent.dataSource.dataSource.offline && this.parent.dataSource.dataSource.url !== '') || isCountRequired(this.parent)) {\n            if (getValue('isExpandCollapse', e)) {\n                this.isRemoteExpand = true;\n            }\n            _super.prototype.appendContent.call(this, target, newChild, e);\n        }\n        else {\n            var info = e.virtualInfo.sentinelInfo && e.virtualInfo.sentinelInfo.axis === 'Y' &&\n                getValue('currentInfo', this).page && getValue('currentInfo', this).page !== e.virtualInfo.page ?\n                getValue('currentInfo', this) : e.virtualInfo;\n            var cBlock = (info.columnIndexes[0]) - 1;\n            var cOffset = this.getColumnOffset(cBlock);\n            var width = void 0;\n            if (this.parent.enableColumnVirtualization) {\n                this.header.virtualEle.adjustTable(cOffset, 0);\n                var cIndex = info.columnIndexes;\n                width = this.getColumnOffset(cIndex[cIndex.length - 1]) - this.getColumnOffset(cIndex[0] - 1) + '';\n                this.header.virtualEle.setWrapperWidth(width);\n            }\n            this.virtualEle.setWrapperWidth(width, (Browser.isIE || Browser.info.name === 'edge'));\n            target = this.parent.createElement('tbody');\n            target.appendChild(newChild);\n            var replace = 'replaceWith';\n            this.getTable().querySelector('tbody')[replace](target);\n            if (!this.isExpandCollapse || this.translateY === 0) {\n                getValue('virtualEle', this).adjustTable(cOffset, this.translateY);\n            }\n            else {\n                this.isExpandCollapse = false;\n            }\n            setValue('prevInfo', this.previousInfo ? this.previousInfo : info, this);\n            if (e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n                this.parent.notify(events.autoCol, {});\n            }\n            var focusCell = 'focusCell';\n            var restoreAdd = 'restoreAdd';\n            var ensureSelectedRowPosition = 'ensureSelectedRowPosition';\n            _super.prototype[focusCell].call(this, e);\n            var isAdd = 'isAdd';\n            if (this[isAdd] && !this.parent.getContent().querySelector('.e-content').querySelector('.e-addedrow')) {\n                if (!(this.rowPosition === 'Top' || this.rowPosition === 'Bottom')) {\n                    if (this.ariaRowIndex >= this.startIndex) {\n                        this.restoreNewRow();\n                    }\n                    else if (this.addRowIndex && this.addRowIndex > -1) {\n                        this[isAdd] = false;\n                        this.parent.isEdit = false;\n                    }\n                }\n            }\n            this.restoreEditState();\n            _super.prototype[restoreAdd].call(this);\n            _super.prototype[ensureSelectedRowPosition].call(this);\n        }\n    };\n    VirtualTreeContentRenderer.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off('data-ready', this.onDataReady);\n        this.parent.off('content-ready', this.fn);\n        this.parent.off('select-virtual-Row', this.toSelectVirtualRow);\n        this.parent.off('dataBound', this.dataBoundEvent);\n        this.parent.off('rowSelected', this.rowSelectedEvent);\n        this.parent.off(events.virtualActionArgs, this.virtualOtherAction);\n        this.parent.off(events.indexModifier, this.indexModifier);\n        this.parent.off('virtual-scroll-edit-action-begin', this.beginEdit);\n        this.parent.off('virtual-scroll-add-action-begin', this.beginAdd);\n        this.parent.off('virtual-scroll-edit-success', this.virtualEditSuccess);\n        this.parent.off('edit-reset', this.resetIseditValue);\n        this.parent.off('get-virtual-data', this.getData);\n        this.parent.off('virtual-scroll-edit-cancel', this.cancelEdit);\n        this.parent.off('select-row-on-context-open', this.toSelectRowOnContextOpen);\n        this.parent.off('refresh-virtual-editform-cells', this.refreshCell);\n        this.parent.off('virtaul-cell-focus', this.cellFocus);\n    };\n    return VirtualTreeContentRenderer;\n}(VirtualContentRenderer));\nexport { VirtualTreeContentRenderer };\nvar TreeInterSectionObserver = /** @class */ (function (_super) {\n    __extends(TreeInterSectionObserver, _super);\n    function TreeInterSectionObserver() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.isWheeling = false;\n        _this.newPos = 0;\n        _this.lastPos = 0;\n        _this.timer = 0;\n        return _this;\n    }\n    TreeInterSectionObserver.prototype.observes = function (callback, onEnterCallback) {\n        var containerRect = 'containerRect';\n        _super.prototype[containerRect] = getValue('options', this).container.getBoundingClientRect();\n        EventHandler.add(getValue('options', this).container, 'scroll', this.virtualScrollHandlers(callback, onEnterCallback), this);\n    };\n    TreeInterSectionObserver.prototype.clear = function () {\n        this.lastPos = null;\n    };\n    TreeInterSectionObserver.prototype.virtualScrollHandlers = function (callback, onEnterCallback) {\n        var _this = this;\n        var delay = Browser.info.name === 'chrome' ? 200 : 100;\n        var options = 'options';\n        var movableEle = 'movableEle';\n        var element = 'element';\n        var fromWheel = 'fromWheel';\n        var debounced100 = debounce(callback, delay);\n        var debounced50 = debounce(callback, 50);\n        this[options].prevTop = this[options].prevLeft = 0;\n        return function (e) {\n            var top = _this[options].movableContainer ? _this[options].container.scrollTop : e.target.scrollTop;\n            var left = _this[options].movableContainer ? _this[options].scrollbar.scrollLeft : e.target.scrollLeft;\n            var direction = _this[options].prevTop < top ? 'down' : 'up';\n            direction = _this[options].prevLeft === left ? direction : _this[options].prevLeft < left ? 'right' : 'left';\n            _this[options].prevTop = top;\n            _this[options].prevLeft = left;\n            var current = _this.sentinelInfo[direction];\n            var delta = 0;\n            _this.newPos = top;\n            if (_this.lastPos != null) { // && newPos < maxScroll\n                delta = _this.newPos - _this.lastPos;\n            }\n            _this.lastPos = _this.newPos;\n            if (_this.timer) {\n                clearTimeout(_this.timer);\n            }\n            _this.timer = setTimeout(_this.clear, 0);\n            if ((delta > 100 || delta < -100) && (e && e.preventDefault)) {\n                e.returnValue = false;\n                e.preventDefault();\n            }\n            if (_this[options].axes.indexOf(current.axis) === -1) {\n                return;\n            }\n            var check = _this.check(direction);\n            if (current.entered && current.axis === 'X') {\n                if (_this[movableEle] && (direction === 'right' || direction === 'left')) {\n                    onEnterCallback(_this[movableEle], current, direction, { top: top, left: left }, _this[fromWheel], check);\n                }\n                else {\n                    onEnterCallback(_this[element], current, direction, { top: top, left: left }, _this[fromWheel], check);\n                }\n            }\n            if (check) {\n                var fn = debounced100;\n                if (current.axis === 'X') {\n                    fn = debounced50;\n                    fn({ direction: direction, sentinel: current, offset: { top: top, left: left },\n                        focusElement: document.activeElement });\n                }\n                else {\n                    callback({ direction: direction, sentinel: current, offset: { top: top, left: left },\n                        focusElement: document.activeElement });\n                }\n            }\n            _this[fromWheel] = false;\n        };\n    };\n    return TreeInterSectionObserver;\n}(InterSectionObserver));\nexport { TreeInterSectionObserver };\n"]},"metadata":{},"sourceType":"module"}